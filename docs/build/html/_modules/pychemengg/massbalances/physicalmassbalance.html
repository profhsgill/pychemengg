

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pychemengg.massbalances.physicalmassbalance &mdash; PyChemEngg 0.1a11 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/katex-math.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js"></script>
        <script src="../../../_static/katex_autorenderer.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-206775075-2']);
  _gaq.push(['_trackPageview']);
</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> PyChemEngg
          

          
          </a>

          
            
            
              <div class="version">
                0.1a11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">User Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide/heattransfer/index.html">Heat Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userguide/massbalances/index.html">Mass Balances</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autosummary_pychemengg.html">PyChemEngg API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyChemEngg</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pychemengg.massbalances.physicalmassbalance</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pychemengg.massbalances.physicalmassbalance</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># This file is part of pyChemEngg python package.</span>
 
<span class="c1"># PyChemEngg: A python-based framework to promote problem solving and critical</span>
<span class="c1"># thinking in chemical engineering.</span>

<span class="c1"># Copyright (c) 2021 Harvinder Singh Gill &lt;profhsgill@gmail.com&gt;</span>

<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c1"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c1"># in the Software without restriction, including without limitation the rights</span>
<span class="c1"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c1"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="c1"># furnished to do so, subject to the following conditions:</span>

<span class="c1"># The above copyright notice and this permission notice shall be included in all</span>
<span class="c1"># copies or substantial portions of the Software.</span>

<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c1"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c1"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c1"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c1"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="c1"># SOFTWARE.</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to perform mass balances on systems without chemical reactions.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span>




<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PhysicalProcess&quot;</span><span class="p">]</span>

<span class="c1">#---------------------------------</span>
<span class="c1"># Main outer class </span>
<span class="c1">#---------------------------------</span>

<div class="viewcode-block" id="PhysicalProcess"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess">[docs]</a><span class="k">class</span> <span class="nc">PhysicalProcess</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Models a physical process such as a mixer, distillation column etc.</span>
<span class="sd">    </span>
<span class="sd">    The physical process can have streams attached to it, and a mass balance</span>
<span class="sd">    can be performed on these streams.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    processname : `str`</span>
<span class="sd">        The name assigned to a physical process as its identifier.  </span>
<span class="sd"> </span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    streamregistry : `dict` {`str`: `pychemengg.physicalmassbalance.PhysicalProcess.Stream`}</span>
<span class="sd">        The streamregistry is a dictionary that stores</span>
<span class="sd">        all streams attached to a physical process.</span>
<span class="sd">        The keys of the dictionary are names of streams and the </span>
<span class="sd">        values are the &quot;Stream&quot; object itself.</span>
<span class="sd">        </span>
<span class="sd"> </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    First import the module **physicalmassbalance**</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">        &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb </span>
<span class="sd">        &gt;&gt;&gt; mixer1 = pmb.PhysicalProcess(&quot;mixer1&quot;)</span>
<span class="sd">        # This will create an instance of &#39;PhysicalProcess&#39; with a name &#39;mixer1&#39;.</span>
<span class="sd">        # Notice that here the same name is used for &#39;variable name&#39; and &#39;process name&#39;.</span>
<span class="sd">        # It does not have to be the same, however, it is less confusing if same</span>
<span class="sd">        # names are used.</span>

<span class="sd">    &quot;&quot;&quot;</span>  
<div class="viewcode-block" id="PhysicalProcess.__init__"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processname</span> <span class="o">=</span> <span class="n">processname</span></div>

        
    <span class="c1">#-------------------------------------------------</span>
    <span class="c1"># Inner &#39;Stream&#39; class and its constructor method</span>
    <span class="c1">#-------------------------------------------------  </span>
    
    
    <span class="c1">#---------------------------------------</span>
    <span class="c1"># &#39;Stream&#39; class constructor method</span>
    <span class="c1">#---------------------------------------  </span>



<div class="viewcode-block" id="PhysicalProcess.attachstreams"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.attachstreams">[docs]</a>    <span class="k">def</span> <span class="nf">attachstreams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">streamnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flowrates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extrainfos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Attach one or more streams to process.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        streamnames : `list` [`str`, `str`, ...]</span>
<span class="sd">            A list containing streamnames.</span>
<span class="sd">        </span>
<span class="sd">        flowrates : `list` [`str` or `int` or `float`, `str` or `int` or `float`, ...]. optional</span>
<span class="sd">            A list containing flowrates for each stream. </span>
<span class="sd">            </span>
<span class="sd">            - Use positive `int` or `float` for inlet stream.</span>
<span class="sd">            - Use negative `int` or `float` for outlet stream.</span>
<span class="sd">            </span>
<span class="sd">            If flowrate is unknown, use:</span>
<span class="sd">            </span>
<span class="sd">            - &quot;F&quot; or &quot;+F&quot; for inlet stream, and</span>
<span class="sd">            - &quot;-F&quot; for outlet stream</span>
<span class="sd">        </span>
<span class="sd">        fractions : `list` [ [`str` or `int` or `float`, `str` or `int` or `float`, ...], [`str` or `int` or `float`, `str` or `int` or `float`, ...], ...]. optional</span>
<span class="sd">            A list containing a list of component fractions for each stream.</span>
<span class="sd">            If the component fraction is unknown use the string &quot;x&quot;.</span>
<span class="sd">        </span>
<span class="sd">        extrainfos : `list` [ [`str`], [`str`], ...], optional</span>
<span class="sd">            A list containing extrainfo for a stream represented as a string.</span>
<span class="sd">            </span>
<span class="sd">            Example:</span>
<span class="sd">            </span>
<span class="sd">            **CASE 1: Relation between component flowrates in different streams is provided.**</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">                Let extrainfo : [&quot;2:S1=1.2*S4&quot;] </span>
<span class="sd">                </span>
<span class="sd">                This means that for component &#39;2&#39;, the &#39;component flowrate&#39; in S1</span>
<span class="sd">                is 1.2 times that in S4.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            **CASE 2: Relation between overall stream flowrates is provided.**</span>
<span class="sd">            </span>
<span class="sd">                Let extrainfo : [&quot;S1=1.2*S4&quot;]</span>
<span class="sd">                </span>
<span class="sd">                This means overall flowrate of stream S1 is 1.2 times the</span>
<span class="sd">                overall flowrate of stream S4.</span>

<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Single `~.Stream` instance OR `list` of `~.Stream` instances</span>
<span class="sd">            If a single stream with just name is created, a single</span>
<span class="sd">            &#39;~.Stream&#39; instance is returned.</span>
<span class="sd">            If more than one stream is created, a list of `~.Stream` instances</span>
<span class="sd">            is returned.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        - The Stream class requires three arguments:</span>
<span class="sd">            </span>
<span class="sd">            i) self : instance of Stream object (passed automatically by Python))</span>
<span class="sd">    </span>
<span class="sd">            ii) instance of physical process</span>
<span class="sd">    </span>
<span class="sd">            iii) streamname</span>
<span class="sd">    </span>
<span class="sd">            By calling the Stream as *PhysicalProcess.Stream(self, streamname)*,</span>
<span class="sd">            the arguments ii) and iii) are being provided. The &#39;self&#39; in this</span>
<span class="sd">            statement is the physical process to which the stream is attached,</span>
<span class="sd">            which is argument ii) and streamname satisfies argument iii).</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        - Attributes</span>

<span class="sd">            There are three `~.Stream` attributes set by this method.</span>
<span class="sd">            </span>
<span class="sd">            - flowrate : `int` or `float` or `str`</span>
<span class="sd">                Stream flowrate.</span>
<span class="sd">            - fractions : a list containing [`int` or `float` or `str`, `int` or `float` or `str`, ... ]</span>
<span class="sd">                Component mass/mole fractions of a stream.</span>
<span class="sd">            - extrainfo : a list of [`str`]</span>
<span class="sd">                Extra information between component or total flowrates between streams.</span>
<span class="sd">                </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">            +---------------------+--------------------+----------------------+</span>
<span class="sd">            |Method of attaching  | &#39;flowrate&#39;         |&#39;fractions&#39; attribute |</span>
<span class="sd">            |&#39;Stream&#39;             | attribute is set as|is set as             |       </span>
<span class="sd">            +=====================+====================+======================+</span>
<span class="sd">            |Just the keyword     | &quot;Not yet defined&quot;  |   &quot;Not yet defined&quot;  |</span>
<span class="sd">            |&quot;streamnames&quot; is used|                    |                      |</span>
<span class="sd">            +---------------------+--------------------+----------------------+</span>
<span class="sd">            |The                  | User supplied      |   User supplied      |</span>
<span class="sd">            |keywords             | values             |   values             |</span>
<span class="sd">            |&quot;streamnames&quot; ,      |                    |                      |</span>
<span class="sd">            |&quot;flowrates&quot; ,        |                    |                      |</span>
<span class="sd">            |&quot;fractions&quot; are used |                    |                      | </span>
<span class="sd">            +---------------------+--------------------+----------------------+</span>
<span class="sd">            </span>
<span class="sd">            - extrainfo attribute is either not set or set to user defined values.</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        ---------</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">            # First import the module **physicalmassbalance**</span>
<span class="sd">            &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">            </span>
<span class="sd">            # Next create instance of physical process, say a mixer</span>
<span class="sd">            &gt;&gt;&gt; mixer1 = pmb.PhysicalProcess(&quot;mixer1&quot;)</span>
<span class="sd">                    </span>
<span class="sd">            </span>
<span class="sd">            # How to attach a single stream with a certain name</span>
<span class="sd">            # -------------------------------------------------</span>
<span class="sd">            &gt;&gt;&gt; mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">            # This will attach a stream named &quot;S1&quot; to &quot;mixer1&quot;.</span>
<span class="sd">            # The returned &#39;~.Stream&#39; instance can be stored as follows.</span>
<span class="sd">            &gt;&gt;&gt; S1 = mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">            # Flowrates and component fractions must be set</span>
<span class="sd">            # separately using setflow, setfractions, and setextrainfo methods.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            # How to attach many streams with given names </span>
<span class="sd">            # --------------------------------------------</span>
<span class="sd">            &gt;&gt;&gt; Water, NaOH, Product = mixer1.attachstreams([&quot;Water&quot;, &quot;NaOH&quot;, &quot;Product&quot;])</span>
<span class="sd">            # The returned stream objects are each stored in the stream variables</span>
<span class="sd">            # Water, NaOH, and Product.</span>
<span class="sd">            # Flowrates and component fractions must be set</span>
<span class="sd">            # separately using setflow, setfractions, and setextrainfo methods.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            # How to attach one or many streams with given names and data</span>
<span class="sd">            # -----------------------------------------------------------</span>
<span class="sd">            &gt;&gt;&gt; streams = [&quot;Water&quot;, &quot;NaOH&quot;, &quot;Product&quot;]</span>
<span class="sd">            &gt;&gt;&gt; flows = [&quot;F&quot;, 1000, &quot;-F&quot;]</span>
<span class="sd">            # Use &#39;F&#39; or &#39;+F&#39; if flowrate is unknown for inlet stream</span>
<span class="sd">            # Use &#39;-F&#39; if flowrate is unknown for outlet stream</span>
<span class="sd">            &gt;&gt;&gt; fractions = [ [&quot;x&quot;,0], [0,1], [&quot;x&quot;, 0.1] ]</span>
<span class="sd">            # Use &#39;x&#39; if a component fraction is unknown.</span>
<span class="sd">            &gt;&gt;&gt; extrainfo = [ [], [], [&quot;Water=0.9*Product&quot;] ]</span>
<span class="sd">            &gt;&gt;&gt; Water, NaOH, Product = mixer1.attachstreams(streamnames=streams,</span>
<span class="sd">                                                            flowrates=flows,</span>
<span class="sd">                                                            fractions=fractions,</span>
<span class="sd">                                                            extrainfos=extrainfo)</span>
<span class="sd">            # Here three streams are created.</span>
<span class="sd">            # The returned stream objects are each stored in the stream variables</span>
<span class="sd">            # Water, NaOH, and Product.</span>
<span class="sd">            # The above process can be carried for one or many streams.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        ---------</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stream_instances_created</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="c1"># CASE : When a stream is created by providing its name but without data.</span>
        
        <span class="k">if</span> <span class="n">streamnames</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">flowrates</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">fractions</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">extrainfos</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">streamname</span> <span class="ow">in</span> <span class="n">streamnames</span><span class="p">:</span>
                <span class="n">tempstream</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamname</span><span class="p">)</span>
                <span class="n">tempstream</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;Not yet defined&quot;</span><span class="p">)</span>
                <span class="n">tempstream</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="s2">&quot;Not yet defined&quot;</span><span class="p">])</span>
                <span class="n">stream_instances_created</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempstream</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_instances_created</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># When there is a single stream, return the stream object.</span>
                <span class="c1"># This is done because user expects an object not a list.</span>
                <span class="c1"># If the list is returned, the user must do the following</span>
                <span class="c1"># to get the Stream object</span>
                <span class="c1"># somename, = mixer1.attachstreams([&quot;somename&quot;])</span>
                <span class="c1">#         | notice this comma in the line above.</span>
                <span class="c1"># Without the comma, the user gets a list containing the ~.Stream</span>
                <span class="k">return</span> <span class="n">stream_instances_created</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># When there are more than one streams, return the list of stream objects.</span>
                <span class="c1"># In this case if the user will do the following, the user gets</span>
                <span class="c1"># the ~.Stream objects.</span>
                <span class="c1"># somename, anothername = mixer1.attachstreams([&quot;somename&quot;, &quot;anothername&quot;])</span>
                <span class="k">return</span> <span class="n">stream_instances_created</span>
        
        <span class="c1"># CASE : When a stream is created by providing name and data.      </span>
        <span class="k">if</span> <span class="n">streamnames</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">flowrates</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">fractions</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If extrainfos are not given for any stream, then</span>
            <span class="c1"># last argument when calling the function &#39;attachstreams&#39; will be &quot;None&quot;.</span>
            <span class="c1"># But a zip function is being used below, so extrainfo must be a list of same</span>
            <span class="c1"># length as the number of streams.</span>
            <span class="c1"># Therefore we transform the empty list before calling zip function</span>
            <span class="k">if</span> <span class="n">extrainfos</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">extrainfos</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">streamnames</span><span class="p">))]</span>   
            <span class="k">for</span> <span class="n">stream</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">fracts</span><span class="p">,</span> <span class="n">einfo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">streamnames</span><span class="p">,</span><span class="n">flowrates</span><span class="p">,</span><span class="n">fractions</span><span class="p">,</span><span class="n">extrainfos</span><span class="p">):</span>
                <span class="n">tempstream</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
                <span class="c1"># If &quot;+F&quot; is entered convert it to &quot;F&quot;</span>
                <span class="c1"># This allows for a simpler logic during subsequent analysis.</span>
                <span class="k">if</span> <span class="n">flow</span> <span class="o">==</span><span class="s2">&quot;+F&quot;</span><span class="p">:</span> <span class="n">flow</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
                <span class="n">tempstream</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                <span class="n">tempstream</span><span class="o">.</span><span class="n">setfractions</span><span class="p">(</span><span class="n">fracts</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">einfo</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if no extrainfo for stream, </span>
                                    <span class="c1"># then do not create this attribute for the stream</span>
                    <span class="n">tempstream</span><span class="o">.</span><span class="n">setextrainfo</span><span class="p">(</span><span class="n">einfo</span><span class="p">)</span>
                <span class="n">stream_instances_created</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempstream</span><span class="p">)</span>
            
            <span class="c1"># The stream objects are returned to caller</span>
            <span class="c1"># (i.e., user who is using the module). </span>
            <span class="c1"># The user may capture them if they desire</span>
            <span class="c1"># or can simply create streams and not bother to capture</span>
            <span class="c1"># them in variables because the streams are anyway registered</span>
            <span class="c1"># in the streamregistry and are available to the code internally.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_instances_created</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># When there is a single stream, return the stream object.</span>
                <span class="c1"># This is done because user expects an object not a list.</span>
                <span class="c1"># If the list is returned, the user must do the following</span>
                <span class="c1"># to capture the Stream object, which is not intuitive</span>
                <span class="c1"># somename, = mixer1.attachstreams([&quot;somename&quot;])</span>
                <span class="c1">#         ^ notice this comma in the line above.</span>
                <span class="c1"># Without the comma, the user gets a list containing the ~.Stream            </span>
                <span class="k">return</span> <span class="n">stream_instances_created</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># When there are more than one streams, return the list of stream objects.</span>
                <span class="c1"># In this case if the user will do the following, the user captures</span>
                <span class="c1"># the ~.Stream objects.</span>
                <span class="c1"># somename, anothername = mixer1.attachstreams([&quot;somename&quot;, &quot;anothername&quot;])</span>
                <span class="k">return</span> <span class="n">stream_instances_created</span></div>
            
           
    <span class="c1">#---------------------------------------</span>
    <span class="c1"># Stream class ... Inner class</span>
    <span class="c1">#---------------------------------------  </span>
<div class="viewcode-block" id="PhysicalProcess.Stream"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream">[docs]</a>    <span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Creates a stream to be attached to a physical process.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instance of physical process : `pychemengg.physicalmassbalance.PhysicalProcess`</span>
<span class="sd">            Physical process to which the created stream will be attached.</span>
<span class="sd">        streamname : `str`</span>
<span class="sd">            Name of stream to be created.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        streamname : `str`</span>
<span class="sd">            Name of stream.</span>
<span class="sd">        connectedprocess : `pychemengg.physicalmassbalance.PhysicalProcess`</span>
<span class="sd">            The instance of physical process to which the stream is attached.</span>
<span class="sd">        flowrate : `int` or `float` or `str`</span>
<span class="sd">            Stream flowrate.</span>
<span class="sd">        fractions : a list containing [`int` or `float` or `str`, `int` or `float` or `str`, ... ]</span>
<span class="sd">            Component mass/mole fractions of a stream.</span>
<span class="sd">        extrainfo : a list of [`str`]</span>
<span class="sd">            Extra information between component or total flowrates between streams.</span>
<span class="sd">                </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">                </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Creates a stream and stores it in streamregistry (a dictionary) of the</span>
<span class="sd">        physical process.</span>
<span class="sd">        </span>
<span class="sd">        ~.streamregistry[streamname] = Stream object</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">            To create an instance of &#39;Stream&#39; use the &#39;attachstreams&#39; method.</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.attachstreams</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setflow</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setfractions</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setextrainfo</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span> 
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instanceof_physical_process</span><span class="p">,</span> <span class="n">streamname</span><span class="p">):</span>
            <span class="c1"># here by Python-rules, self is instance of class &#39;Stream&#39;            </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">streamname</span> <span class="o">=</span> <span class="n">streamname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectedprocess</span> <span class="o">=</span> <span class="n">instanceof_physical_process</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectedprocess</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">streamname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>  
            <span class="c1"># self on RHS is instance of class &#39;Stream&#39;</span>

        
        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------</span>
<div class="viewcode-block" id="PhysicalProcess.Stream.setflow"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setflow">[docs]</a>        <span class="k">def</span> <span class="nf">setflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span> <span class="c1"># setflow for a stream</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sets flowrate of a stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            flow : `int or float or str`</span>
<span class="sd">                Flowrate of the stream.</span>
<span class="sd">                </span>
<span class="sd">                - Use positive `int` or `float` for inlet stream.</span>
<span class="sd">                - Use negative `int` or `float` for outlet stream.</span>
<span class="sd">                </span>
<span class="sd">                If flowrate is unknown, use:</span>
<span class="sd">                </span>
<span class="sd">                - &quot;F&quot; or &quot;+F&quot; for inlet stream, and</span>
<span class="sd">                - &quot;-F&quot; for outlet stream</span>
<span class="sd">                 </span>
<span class="sd">                                    </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            Creates an attribute &#39;flowrate&#39; for the stream and assigns</span>
<span class="sd">            it a value.</span>
<span class="sd">                         </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                # For a physical process &#39;mixer1&#39; and say a stream &#39;S1&#39;,</span>
<span class="sd">                # flowrate can be set as follows.</span>
<span class="sd">                # First import the module **physicalmassbalance**</span>
<span class="sd">                &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">                </span>
<span class="sd">                # Next create instance of physical process, say a mixer</span>
<span class="sd">                &gt;&gt;&gt; mixer1 = pmb.PhysicalProcess(&quot;mixer1&quot;)</span>
<span class="sd">                # Next, a single stream with a certain name can be attached</span>
<span class="sd">                # ---------------------------------------------------------</span>
<span class="sd">                &gt;&gt;&gt; mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">                # This will attach a stream named &quot;S1&quot; to &quot;mixer1&quot;.</span>
<span class="sd">                # The returned &#39;~.Stream&#39; instance can be stored as follows.</span>
<span class="sd">                &gt;&gt;&gt; S1 = mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">                # If flowrate is 1335, it can be assigned as</span>
<span class="sd">                &gt;&gt;&gt; S1.setflow(1335)</span>
<span class="sd">                &gt;&gt;&gt; print(S1.flowrate)</span>
<span class="sd">                1335</span>
<span class="sd">                # If flowrate is -300 (assuming stream is outlet)</span>
<span class="sd">                &gt;&gt;&gt; S1.setflow(-300)</span>
<span class="sd">                &gt;&gt;&gt; print(S1.flowrate)</span>
<span class="sd">                -300</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            See Also</span>
<span class="sd">            --------</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.attachstreams</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setfractions</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setextrainfo       </span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>  
            <span class="c1"># If &quot;+F&quot; is entered convert it to &quot;F&quot;</span>
            <span class="c1"># This allows for a simpler logic during subsequent analysis.</span>
            <span class="k">if</span> <span class="n">flow</span> <span class="o">==</span><span class="s2">&quot;+F&quot;</span><span class="p">:</span> <span class="n">flow</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span> <span class="o">=</span> <span class="n">flow</span>            </div>

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------</span>
<div class="viewcode-block" id="PhysicalProcess.Stream.setfractions"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setfractions">[docs]</a>        <span class="k">def</span> <span class="nf">setfractions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fracts</span><span class="p">):</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set component mole/mass fractions of a stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            fracts: A list of [`int or float or str`, `int or float or str`, ...]</span>
<span class="sd">                Mass or mole fractions of stream components.</span>
<span class="sd">                </span>
<span class="sd">                If a fraction for a component is unknown, use:</span>
<span class="sd">                </span>
<span class="sd">                - &quot;x&quot; </span>
<span class="sd">                 </span>
<span class="sd">                                    </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            Creates an attribute &#39;fractions&#39; for the stream and assigns</span>
<span class="sd">            it a value.</span>
<span class="sd">                         </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                # For a physical process &#39;mixer1&#39; and say a stream &#39;S1&#39;,</span>
<span class="sd">                # flowrate can be set as follows.</span>
<span class="sd">                # First import the module **physicalmassbalance**</span>
<span class="sd">                &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">                </span>
<span class="sd">                # Next create instance of physical process, say a mixer</span>
<span class="sd">                &gt;&gt;&gt; mixer1 = pmb.PhysicalProcess(&quot;mixer1&quot;)</span>
<span class="sd">                # Next, a single stream with a certain name can be attached</span>
<span class="sd">                # ---------------------------------------------------------</span>
<span class="sd">                &gt;&gt;&gt; mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">                # This will attach a stream named &quot;S1&quot; to &quot;mixer1&quot;.</span>
<span class="sd">                # The returned &#39;~.Stream&#39; instance can be stored as follows.</span>
<span class="sd">                &gt;&gt;&gt; S1 = mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">                # If the stream has four components and with mass fractions</span>
<span class="sd">                # 0.1, 0.3, 0.5, 0.1, then specify them as follows:</span>
<span class="sd">                &gt;&gt;&gt; S1.setfractions([0.1, 0.3, 0.5, 0.1]</span>
<span class="sd">                # If one of them in an unknown, say component &#39;3&#39;</span>
<span class="sd">                &gt;&gt;&gt; S.setfractions([0.1, 0.3, &quot;x&quot;, 0.1])</span>
<span class="sd">                </span>

<span class="sd">            See Also</span>
<span class="sd">            --------</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.attachstreams</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setflow</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setextrainfo       </span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fractions</span> <span class="o">=</span> <span class="n">fracts</span></div>
            
        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------</span>
<div class="viewcode-block" id="PhysicalProcess.Stream.setextrainfo"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setextrainfo">[docs]</a>        <span class="k">def</span> <span class="nf">setextrainfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span> 
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set extra information of a stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            extrainfo: A list of [`str`, ...]</span>
<span class="sd">                String representation of relationship between overall or</span>
<span class="sd">                component flowrates amongst different streams, or</span>
<span class="sd">                some other relationship that can help solve the mass balance.</span>
<span class="sd">                                  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            Creates an attribute &#39;extrainfo&#39; for the stream and assigns</span>
<span class="sd">            it a value.</span>
<span class="sd">                         </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                # For a physical process &#39;mixer1&#39; and say a stream &#39;S1&#39;,</span>
<span class="sd">                # flowrate can be set as follows.</span>
<span class="sd">                # First import the module **physicalmassbalance**</span>
<span class="sd">                &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">                </span>
<span class="sd">                # Next create instance of physical process, say a mixer</span>
<span class="sd">                &gt;&gt;&gt; mixer1 = pmb.PhysicalProcess(&quot;mixer1&quot;)</span>
<span class="sd">                # Next, a single stream with a certain name can be attached</span>
<span class="sd">                # ---------------------------------------------------------</span>
<span class="sd">                &gt;&gt;&gt; mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">                # This will attach a stream named &quot;S1&quot; to &quot;mixer1&quot;.</span>
<span class="sd">                # The returned &#39;~.Stream&#39; instance can be stored as follows.</span>
<span class="sd">                &gt;&gt;&gt; S1 = mixer1.attachstreams([&quot;S1&quot;])</span>
<span class="sd">                # Say that stream S1 overall flowrate is half that of S4</span>
<span class="sd">                # then S1=0.5*S4</span>
<span class="sd">                &gt;&gt;&gt; S1.extrainfo[[&quot;S1=0.5*S4&quot;]]</span>
<span class="sd">                            </span>
<span class="sd">    </span>
<span class="sd">            See Also</span>
<span class="sd">            --------</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.attachstreams</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setflow</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setfractions      </span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo</span> <span class="o">=</span> <span class="n">info</span></div>
        
        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------</span>
<div class="viewcode-block" id="PhysicalProcess.Stream.deleteextrainfo"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.deleteextrainfo">[docs]</a>        <span class="k">def</span> <span class="nf">deleteextrainfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># delete extra info of a stream</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Delete extra information of a stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            None</span>
<span class="sd">                                  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            Deletes &#39;extrainfo&#39; attribute of a stream if it exists</span>
<span class="sd">                         </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                &gt;&gt;&gt; S1.deleteextrainfo()</span>
<span class="sd">                            </span>
<span class="sd">    </span>
<span class="sd">            See Also</span>
<span class="sd">            --------</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.attachstreams</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setflow</span>
<span class="sd">            pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setfractions      </span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;extrainfo&quot;</span><span class="p">):</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;extrainfo&quot;</span><span class="p">)</span> </div>
        
        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------</span>
        <span class="c1"># copy one stream to another</span>
<div class="viewcode-block" id="PhysicalProcess.Stream.setequalto"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.Stream.setequalto">[docs]</a>        <span class="k">def</span> <span class="nf">setequalto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamtocopy</span><span class="p">,</span>  <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">):</span>
    
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Copy data of one stream to another stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            streamtocopy : `pychemengg.physicalmassbalance.PhysicalProcess.Stream`</span>
<span class="sd">                Stream to be copied.</span>
<span class="sd">            destination : `pychemengg.physicalmassbalance.PhysicalProcess.Stream`</span>
<span class="sd">                Destination stream. &quot;self&quot; is the destination stream.</span>
<span class="sd">            flowdirection : `str`</span>
<span class="sd">                &quot;+&quot; or &quot;-&quot; depending on whether destination stream is entering</span>
<span class="sd">                or exiting the physical process, default = &quot;+&quot;</span>
<span class="sd">                                  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                # Consider two physical processes &#39;process1&#39; and &#39;process2&#39;.</span>
<span class="sd">                # Consider a stream S1 from process1 enters process2 as S2.</span>
<span class="sd">                # Then it would be desirable to set S2 equal to S1 so that</span>
<span class="sd">                # data of S1 can be copied into S2.</span>
<span class="sd">                # This can be done as follows.</span>
<span class="sd">                # First import the module **physicalmassbalance**</span>
<span class="sd">                &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">                </span>
<span class="sd">                # Next create instance of physical process process1</span>
<span class="sd">                &gt;&gt;&gt; process1 = pmb.PhysicalProcess(&quot;process1&quot;)</span>

<span class="sd">                # Attach S1 to process1.</span>
<span class="sd">                &gt;&gt;&gt; process1.S1 = process1.attachstreams(streamnames=[&quot;S1&quot;], flowrates=[-300], fractions=[[0.1, 0.3, 0.6]])</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; print(process1)</span>
<span class="sd">                # Output is as follows:</span>
<span class="sd">                    </span>
<span class="sd">                ====================================</span>
<span class="sd">                Process streams for &#39;process1&#39; are :</span>
<span class="sd">                ====================================</span>
<span class="sd">                Stream = S1; Flowrate = -300.00; Fractions = [&#39;0.1000&#39;, &#39;0.3000&#39;, &#39;0.6000&#39;]; Extra Info = None </span>
<span class="sd">                ------------------------------------</span>
<span class="sd">                END</span>
<span class="sd">                </span>
<span class="sd">                # Next create instance of physical process process2</span>
<span class="sd">                &gt;&gt;&gt; process2 = pmb.PhysicalProcess(&quot;process2&quot;)</span>
<span class="sd">                # Attach S2 to process2</span>
<span class="sd">                &gt;&gt;&gt; process2.S2 = process2.attachstreams(streamnames=[&quot;S2&quot;])</span>
<span class="sd">                &gt;&gt;&gt; process2.S2.setequalto(process1.S1, flowdirection=&quot;+&quot;)</span>
<span class="sd">                # S2 is inlet thus it has &#39;+&#39; sign for flowdirection</span>
<span class="sd">                &gt;&gt;&gt; print(process2)</span>
<span class="sd">                </span>
<span class="sd">                ====================================</span>
<span class="sd">                Process streams for &#39;process2&#39; are :</span>
<span class="sd">                ====================================</span>
<span class="sd">                Stream = S2; Flowrate = 300.00; Fractions = [&#39;0.1000&#39;, &#39;0.3000&#39;, &#39;0.6000&#39;]; Extra Info = None </span>
<span class="sd">                ------------------------------------</span>
<span class="sd">                END</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">tempstream</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">streamtocopy</span><span class="p">)</span> <span class="c1"># this is done so that we do not change original</span>
                                                     <span class="c1"># stream passed to the method</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tempstream</span><span class="p">,</span> <span class="s2">&quot;flowrate&quot;</span><span class="p">):</span>
                <span class="n">directionof_stream_beingcopied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectedprocess</span><span class="o">.</span><span class="n">_getsignof</span><span class="p">(</span><span class="n">tempstream</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                <span class="n">direction_required</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">flowdirection</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
            
            <span class="c1"># Direction of stream being coppied can be &#39;+&#39; or &#39;-&#39;</span>
            <span class="c1"># The following logic correctly assigns the desired flowdirection</span>
            <span class="c1"># to copied stream. It applied __pos__ and __neg__ methods</span>
            <span class="c1"># such as -tempstream or +tempstream to first get the correct sign</span>
            <span class="c1"># and then assign this to copied stream</span>
            <span class="k">if</span> <span class="n">direction_required</span> <span class="o">*</span> <span class="n">directionof_stream_beingcopied</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">((</span><span class="o">-</span><span class="n">tempstream</span><span class="p">)</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="c1"># here first -tempstream changes flow sign</span>
                                                    <span class="c1"># then this new flowrate is assigned to copied object</span>
            <span class="k">if</span> <span class="n">direction_required</span> <span class="o">*</span> <span class="n">directionof_stream_beingcopied</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">((</span><span class="o">+</span><span class="n">tempstream</span><span class="p">)</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span><span class="c1"># here first -tempstream changes flow sign</span>
                                                    <span class="c1"># then this new flowrate is assigned to copied object</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">streamtocopy</span><span class="p">,</span> <span class="s2">&quot;fractions&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setfractions</span><span class="p">(</span><span class="n">tempstream</span><span class="o">.</span><span class="n">fractions</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">streamtocopy</span><span class="p">,</span> <span class="s2">&quot;extrainfo&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setextrainfo</span><span class="p">(</span><span class="n">tempstream</span><span class="o">.</span><span class="n">extrainfo</span><span class="p">)</span></div>

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------   </span>
        <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Performs unary operation &#39;+&#39; on flow rate of a stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            stream : `pychemengg.physicalmassbalance.PhysicalProcess.Stream`</span>
<span class="sd">                Instance of `~.Stream` whose flow rate will be operated on.</span>
<span class="sd">                                  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            stream : `pychemengg.physicalmassbalance.PhysicalProcess.Stream`</span>
<span class="sd">                Instance of `~.Stream` without change to flow rate is returned.</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                # For a stream &#39;S1&#39; attached to &#39;process1&#39;</span>
<span class="sd">                &gt;&gt;&gt; +S1</span>
<span class="sd">                # The stream is returned without change to flowrate</span>

<span class="sd">            &quot;&quot;&quot;</span>    
        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span> <span class="o">==</span> <span class="s2">&quot;-F&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>
        

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------   </span>
        <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># unary operator &#39;-&#39; to negate flow rate of a passed stream</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Performs unary operation &#39;-&#39; on flow rate of a stream.</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            stream : `pychemengg.physicalmassbalance.PhysicalProcess.Stream`</span>
<span class="sd">                Instance of `~.Stream` whose flow rate will be operated on.</span>
<span class="sd">                                  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            stream : `pychemengg.physicalmassbalance.PhysicalProcess.Stream`</span>
<span class="sd">                Instance of `~.Stream` with negated flow rate is returned.</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                # For a stream &#39;S1&#39; attached to &#39;process1&#39;</span>
<span class="sd">                &gt;&gt;&gt; +S1</span>
<span class="sd">                # The stream is returned with negated flowrate</span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span> <span class="o">==</span> <span class="s2">&quot;-F&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------        </span>
        <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c1"># overload binary &#39;+&#39; operator on object &#39;Stream&#39;</span>
            
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Method to add two streams</span>
<span class="sd">            1) flowrates get added by first applying &#39;abs&#39; on flowrates</span>
<span class="sd">            2) component fractions are computed for the mixed stream</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">tempprocess</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;tempprocess&quot;</span><span class="p">)</span> <span class="c1"># create instance of class</span>
            <span class="n">tempstream</span> <span class="o">=</span> <span class="n">tempprocess</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">])</span> <span class="c1"># create a temporary stream to return</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">totalflow</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unable to add stream flowrates.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check flow rate values to ensure they are all known.&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Caught an error in method &#39;add&#39; of Stream class while computing totalflow&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tempstream</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="n">totalflow</span><span class="p">)</span> <span class="c1"># set flow rate of temp stream</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total flow = &quot;</span><span class="p">,</span> <span class="n">totalflow</span><span class="p">)</span>
            
            <span class="c1"># compute component fractions of mixed stream</span>
            <span class="n">tempfractions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fractions</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">fractions</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tempfractions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flowrate</span><span class="p">))</span> <span class="o">/</span> <span class="n">totalflow</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cannot compute fractions in added streams because:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknown fractions or flowrates may exist in one of the streams.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Caught an error in method &#39;add&#39; of Stream class while computing tempfractions&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tempfractions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fractions&quot;</span><span class="p">,</span> <span class="n">tempfractions</span><span class="p">)</span>        
            <span class="n">tempstream</span><span class="o">.</span><span class="n">setfractions</span><span class="p">(</span><span class="n">tempfractions</span><span class="p">)</span> <span class="c1"># set fractions of temp stream</span>
            <span class="k">del</span> <span class="n">tempprocess</span> <span class="c1"># delete &quot;tempprocess&quot; </span>
            <span class="k">return</span> <span class="n">tempstream</span> <span class="c1"># return temp stream </span>

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------        </span>
        <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c1"># overload binary &#39;-&#39; operator on object &#39;Stream&#39;</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Method to subtract two streams</span>
<span class="sd">            1) flowrates get subtracted by first applying &#39;abs&#39; on flowrates</span>
<span class="sd">            2) component fractions are computed for the mixed stream</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">tempprocess</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;tempprocess&quot;</span><span class="p">)</span> <span class="c1"># create instance of class to s</span>
            <span class="n">tempstream</span> <span class="o">=</span> <span class="n">tempprocess</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">])</span> <span class="c1"># create a temporary stream to return</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">totalflow</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unable to add stream flowrates.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check flow rate values to ensure they are all known.&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Caught an error in method &#39;subtract&#39; of Stream class while computing totalflow&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tempstream</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="n">totalflow</span><span class="p">)</span> <span class="c1"># set flow rate of temp stream</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total flow = &quot;</span><span class="p">,</span> <span class="n">totalflow</span><span class="p">)</span>
            <span class="n">tempfractions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fractions</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">fractions</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tempfractions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flowrate</span><span class="p">))</span> <span class="o">/</span> <span class="n">totalflow</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cannot compute fractions in added streams because:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknown fractions or flowrates may exist in one of the streams.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Caught an error in method &#39;subtract&#39; of Stream class while computing tempfractions&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tempfractions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fractions&quot;</span><span class="p">,</span> <span class="n">tempfractions</span><span class="p">)</span>        
            <span class="n">tempstream</span><span class="o">.</span><span class="n">setfractions</span><span class="p">(</span><span class="n">tempfractions</span><span class="p">)</span> <span class="c1"># set fractions of temp stream</span>
            <span class="k">del</span> <span class="n">tempprocess</span> <span class="c1"># delete &quot;tempprocess&quot; </span>
            <span class="k">return</span> <span class="n">tempstream</span> <span class="c1"># return temp stream </span>

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------         </span>
        <span class="k">def</span> <span class="nf">_calc_missing_xfraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Computes the missing &#39;x&#39; fraction in a </span>
<span class="sd">            given stream by using x = 1</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            List containing [`bool`, `float` or `str`]</span>
<span class="sd">            </span>
<span class="sd">            - If `bool` == True, `float`= computed &#39;x&#39; value</span>
<span class="sd">            - If `bool` == False, `str` = text message</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fractions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">missingx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fractions</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">]))</span> <span class="c1"># because x = 1</span>
                <span class="k">return</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="n">missingx</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fractions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;More than one &#39;x&#39; unknown fractions in the stream. x = 1 is insufficient to find them.&quot;</span>
                <span class="k">return</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fractions</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;There are no missing fractions.&quot;</span>
                <span class="k">return</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="p">]</span>   

        <span class="c1"># Method of inner &#39;Stream&#39; class</span>
        <span class="c1">#---------------------------------         </span>
        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Implements &#39;print&#39; function on Stream instance</span>
<span class="sd">                       </span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;extrainfo&quot;</span><span class="p">):</span>
                <span class="n">storedextrainfo</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">storedextrainfo</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
            <span class="n">unit_name</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectedprocess</span><span class="o">.</span><span class="n">processname</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            
            <span class="c1">##### Older version start</span>
            <span class="c1"># return(&#39;Stream: {streamname}\n&#39;</span>
            <span class="c1"># &#39;Attached to the physical process: {connectedprocess.processname}\n&#39;</span>
            <span class="c1"># &#39;flowrate: {flowrate}\n&#39;</span>
            <span class="c1"># &#39;fractions: {fractions}\n&#39;</span>
            <span class="c1"># ).format(**self.__dict__) + &quot;extrainfo: &quot; + storedextrainfo</span>
            <span class="c1">##### Older version ends</span>
            
            <span class="n">text_to_print</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Stream: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">streamname</span><span class="si">}</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Attached to the physical process: </span><span class="si">{</span><span class="n">unit_name</span><span class="si">}</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">flowrate: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">flowrate</span><span class="si">}</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">fractions: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fractions</span><span class="si">}</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">extrainfo: </span><span class="si">{</span><span class="n">storedextrainfo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">text_to_print</span></div>
       
    <span class="c1">#-----------------------------------------</span>
    <span class="c1"># Methods for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------</span>
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------    </span>
    <span class="k">def</span> <span class="nf">_make_numpyarrayof_fractions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Creates numpy array of all stream-fractions for a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">streamobject</span><span class="o">.</span><span class="n">fractions</span> <span class="k">for</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------                </span>
    <span class="k">def</span> <span class="nf">_make_numpyarrayof_flowrates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Creates numpy array of all stream-flowrates for a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">streamobject</span><span class="o">.</span><span class="n">flowrate</span> <span class="k">for</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="c1"># print(&quot;makenumpyFlowrate = &quot;, np.vstack(a))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------    </span>
    <span class="k">def</span> <span class="nf">_make_numpyarrayof_streamnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Creates numpy array of all stream-names for a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">streamname</span> <span class="k">for</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------    </span>
    <span class="k">def</span> <span class="nf">_make_arrayof_extrainfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Creates numpy array of all stream-extrainfos for a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">streamobject</span><span class="p">,</span> <span class="s1">&#39;extrainfo&#39;</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">streamobject</span><span class="o">.</span><span class="n">extrainfo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">a</span>
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------    </span>
    <span class="k">def</span> <span class="nf">_parse_extrainfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This method parses the extra info for &#39;TOTAL flowrate&#39; relationship OR</span>
<span class="sd">        &#39;COMPONENT flowrate&#39; relationship between streams.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        parsed_extrainfo : as list of lists</span>
<span class="sd">                            [[], [],[]]</span>
<span class="sd">            Each sub list contains the following list elements </span>
<span class="sd">          </span>
<span class="sd">            CASE 1: COMPONENT flowrate relationship</span>
<span class="sd">            [componentindex, left_streamsign, left_streamname, ratio, right_streamname]</span>

<span class="sd">            example:</span>
<span class="sd">                let extrainfo : [&quot;2:S1=1.2*S4&quot;] </span>
<span class="sd">                This means for component &#39;2&#39;, the component flowrate in S1 is 1.2 times that in S4</span>
<span class="sd">                So component &#39;2&#39; flowrates in S1 and S4 will be</span>
<span class="sd">                    in S1 = F * x (F = total flowrate of S1, and x = component &#39;2&#39; fraction in S1)</span>
<span class="sd">                    in S4 = F * x (F = total flowrate of S4, and x = component &#39;2&#39; fraction in S4)</span>
<span class="sd">                And equation becomes : abs(F*x for S1) - abs(F*x for S4) = 0</span>
<span class="sd">                This equation is NOT formulated by this method/function.</span>
<span class="sd">                This method/function ONLY parses the information input by user</span>
<span class="sd">                in a manner it can be used later to formulate this equation</span>
<span class="sd">                </span>
<span class="sd">                So the extrainfo can be parsed as follows:</span>
<span class="sd">                componentindex = &#39;2&#39;   </span>
<span class="sd">                left_streamsign = +1 if &#39;S1&#39; is input</span>
<span class="sd">                                 -1 if &#39;S1&#39; is output</span>
<span class="sd">                left_streamname = &#39;S1&#39;</span>
<span class="sd">                ratio = &#39;1.2&#39;</span>
<span class="sd">                right_streamname = &#39;S4&#39;</span>
<span class="sd">                </span>
<span class="sd">                NOTE: &quot;left_streamsign&quot; is NOT needed to formulate the desired</span>
<span class="sd">                equation for &#39;COMPONENT flowrate&#39; relationship. But it is required for</span>
<span class="sd">                &#39;OVERALL flowrate&#39; relationship between streams. Therefore to maintain</span>
<span class="sd">                uniformity in signature of &#39;return value&#39;, we keep this field</span>

<span class="sd">            CASE 2: OVERALL flowrate relationship</span>
<span class="sd">            [componentindex, left_streamsign, left_streamname, ratio, right_streamname]</span>
<span class="sd">            example:</span>
<span class="sd">                let extrainfo : [&quot;S1=1.2*S4&quot;] </span>
<span class="sd">                then:</span>
<span class="sd">                componentindex = FALSE</span>
<span class="sd">                left_streamsign = +1 if &#39;S1&#39; is input</span>
<span class="sd">                                 -1 if &#39;S1&#39; is output</span>
<span class="sd">                left_streamname = &#39;S1&#39;</span>
<span class="sd">                ratio = 1.2</span>
<span class="sd">                right_streamname = &#39;S4&#39;</span>
<span class="sd">                </span>
<span class="sd">                Out put of this method is then used to create the equation</span>
<span class="sd">                </span>
<span class="sd">                left_streamflow - left_streamsign * abs(eval(ratio) * right_streamflow)</span>
<span class="sd">                </span>
<span class="sd">                The reasoning is that the righthandside should evaluate</span>
<span class="sd">                to flowrate of S1, and the sign should be +1 or -1 based on convention</span>
<span class="sd">                chosen of input or output streams respectively</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_extrainfo</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">streamobject</span><span class="p">,</span> <span class="s1">&#39;extrainfo&#39;</span><span class="p">):</span>
                <span class="c1"># print(streamobject.extrainfo)</span>
                <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">streamobject</span><span class="o">.</span><span class="n">extrainfo</span><span class="p">:</span>
                    <span class="c1"># first parse for &#39;component flowrate&#39;</span>
                    <span class="c1"># if info is not for &#39;component flowrate&#39;</span>
                    <span class="c1"># the first statement of &#39;try&#39; will fail</span>
                    <span class="c1"># it then helps to decide that the relationship</span>
                    <span class="c1"># is for total stream flowrates</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">componentindex</span><span class="p">,</span> <span class="n">other_1</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="n">left_streamname</span><span class="p">,</span> <span class="n">other_2</span> <span class="o">=</span> <span class="n">other_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>          
                        <span class="n">ratio</span><span class="p">,</span> <span class="n">right_streamname</span> <span class="o">=</span> <span class="n">other_2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
                        <span class="c1"># Check if left_stream and right_stream are both</span>
                        <span class="c1"># attached to the same process.</span>
                        <span class="c1"># If there are more than one processes that are</span>
                        <span class="c1"># interconnected, say process1 and process2,</span>
                        <span class="c1"># then the extra information maybe between a stream</span>
                        <span class="c1"># in process1 and another stream from process2.</span>
                        <span class="c1"># In this case unless a balance is made by placing</span>
                        <span class="c1"># a boundary that encloses both these processes</span>
                        <span class="c1"># (like an overall balance), then this extra information</span>
                        <span class="c1"># is not usable.</span>
                        <span class="n">stream_names_in_process</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">left_streamname</span> <span class="ow">in</span> <span class="n">stream_names_in_process</span> <span class="ow">and</span> <span class="n">right_streamname</span> <span class="ow">in</span> <span class="n">stream_names_in_process</span><span class="p">:</span>
                            <span class="n">left_streamsign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getsignof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">left_streamname</span><span class="p">]</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                            <span class="n">right_streamsign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getsignof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">right_streamname</span><span class="p">]</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">componentindex</span><span class="p">,</span> <span class="n">left_streamsign</span><span class="p">,</span> <span class="n">left_streamname</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">right_streamsign</span><span class="p">,</span> <span class="n">right_streamname</span><span class="p">]</span>
                            <span class="n">parsed_extrainfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># print(items)</span>
                        <span class="n">left_streamname</span><span class="p">,</span> <span class="n">other_2</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                        <span class="n">ratio</span><span class="p">,</span> <span class="n">right_streamname</span> <span class="o">=</span> <span class="n">other_2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
                        <span class="c1"># Check if left_stream and right_stream are both</span>
                        <span class="c1"># attached to the same process.</span>
                        <span class="c1"># If there are more than one processes that are</span>
                        <span class="c1"># interconnected, say process1 and process2,</span>
                        <span class="c1"># then the extra information maybe between a stream</span>
                        <span class="c1"># in process1 and another stream from process2.</span>
                        <span class="c1"># In this case unless a balance is made by placing</span>
                        <span class="c1"># a boundary that encloses both these processes</span>
                        <span class="c1"># (like an overall balance), then this extra information</span>
                        <span class="c1"># is not usable.</span>
                        <span class="n">stream_names_in_process</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">left_streamname</span> <span class="ow">in</span> <span class="n">stream_names_in_process</span> <span class="ow">and</span> <span class="n">right_streamname</span> <span class="ow">in</span> <span class="n">stream_names_in_process</span><span class="p">:</span>
                            <span class="n">left_streamsign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getsignof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">left_streamname</span><span class="p">]</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                            <span class="n">right_streamsign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getsignof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">right_streamname</span><span class="p">]</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="n">left_streamsign</span><span class="p">,</span> <span class="n">left_streamname</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">right_streamsign</span><span class="p">,</span> <span class="n">right_streamname</span><span class="p">]</span>
                            <span class="c1"># print(&quot;extra Info&quot;, temp)</span>
                            <span class="n">parsed_extrainfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parsed_extrainfo</span>



    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------</span>
    
    <span class="k">def</span> <span class="nf">_make_numpyarraysof_streamdata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Creates numpy array of all stream attributes for a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># organize information given by user for the process streams</span>
        <span class="c1"># into individual arrays for convenient processing of data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_numpyarrayof_streamnames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_numpyarrayof_fractions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_numpyarrayof_flowrates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrainfos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_arrayof_extrainfo</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>

        
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------  </span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_whereplusFs</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Finds location of &quot;F&quot; in the streams of a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arg : Input parameter = list of flowrates</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span><span class="o">==</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------      </span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_whereminusFs</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Finds location of &quot;-F&quot; in the streams of a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arg : Input parameter = list of flowrates</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span><span class="o">==</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------      </span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_find_wherexs</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Finds location of &quot;x&quot; in the streams of a physical process.</span>
<span class="sd">                   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arg : Input parameter = list of fractions</span>
        <span class="c1">#                         of single stream</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span><span class="o">==</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>
   
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------   </span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_thesestreams</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Implements &#39;print&#39; function for a physical process.</span>
<span class="sd">                  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">print_thesestreams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">streamstoprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span>
        <span class="k">if</span> <span class="n">print_thesestreams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">streamstoprint</span> <span class="o">=</span> <span class="n">print_thesestreams</span>            
        <span class="c1"># print header info before printing data</span>
        <span class="n">headerstring</span> <span class="o">=</span> <span class="s2">&quot;Process streams for &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; are :&quot;</span>
        <span class="n">headerstring_charactercount</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">chars</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">headerstring</span> <span class="k">for</span> <span class="n">chars</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">headerstring_charactercount</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">headerstring</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">headerstring_charactercount</span><span class="p">)</span>
        
        <span class="c1"># func for mapping fractions of streams for formatting</span>
        <span class="c1"># This is done because fractions can be float or string (i.e. &#39;x&#39;)</span>
        <span class="k">def</span> <span class="nf">_get_formatspecfor_fractions</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:^6s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:^.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        
        <span class="c1"># find max length of string names to set length of display field</span>
        <span class="n">max_streamname_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="k">for</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">streamstoprint</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="n">formatfor_streamname</span> <span class="o">=</span> <span class="s2">&quot;{0:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">max_streamname_length</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;s}&quot;</span>

        <span class="c1"># find max length of flow rates to set length of display field</span>
        <span class="n">maxflow1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span> <span class="k">for</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">streamstoprint</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxflow2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="k">for</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">streamstoprint</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxflow</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxflow1</span><span class="p">,</span> <span class="n">maxflow2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="n">streamstoprint</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># prepare flowrate for printing</span>
            <span class="c1"># check if flowrate value for a stream is &#39;F&#39; or &#39;-F&#39; or float</span>
            <span class="c1"># and accordingly prepare format specification</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">streamobject</span><span class="o">.</span><span class="n">flowrate</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">flowformatter</span> <span class="o">=</span> <span class="s2">&quot;{1:&gt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">maxflow</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;s}&quot;</span> <span class="c1"># 3 added to maxflow to match ... see below</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flowformatter</span> <span class="o">=</span> <span class="s2">&quot;{1:&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">maxflow</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.2f}&quot;</span> <span class="c1"># 3 added to maxflow = one for period, and two for 2 digits after period</span>
            <span class="c1"># prepare fractions for printing</span>
            <span class="c1"># check if fraction value for a stream is &#39;x&#39; or float</span>
            <span class="c1"># and accordingly prepare format specification</span>
            <span class="c1"># use map function to process all fractions</span>
            <span class="n">streamfractions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_get_formatspecfor_fractions</span><span class="p">,</span><span class="n">streamobject</span><span class="o">.</span><span class="n">fractions</span><span class="p">))</span>          
            <span class="c1"># prepare full string format</span>
            <span class="n">prtString</span> <span class="o">=</span> <span class="s2">&quot;Stream = &quot;</span> <span class="o">+</span> <span class="n">formatfor_streamname</span> <span class="o">+</span> <span class="s2">&quot;; Flowrate = &quot;</span> <span class="o">+</span> <span class="n">flowformatter</span> <span class="o">+</span><span class="s2">&quot;; Fractions = </span><span class="si">{2}</span><span class="s2">; Extra Info = </span><span class="si">{3}</span><span class="s2"> &quot;</span>
            <span class="c1"># prepare string values to be printed based on whether &#39;extrainfo&#39; exists for a stream or not</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">streamobject</span><span class="p">,</span> <span class="s2">&quot;extrainfo&quot;</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">prtString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span> <span class="n">streamfractions</span><span class="p">,</span> <span class="n">streamobject</span><span class="o">.</span><span class="n">extrainfo</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">prtString</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">streamname</span><span class="p">,</span> <span class="n">streamobject</span><span class="o">.</span><span class="n">flowrate</span><span class="p">,</span> <span class="n">streamfractions</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="n">headerstring_charactercount</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="s2">&quot;END</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="c1"># this is symbolic return because __str__ must return something</span>
                        <span class="c1"># otherwise print gives TypeError </span>

        
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------    </span>
<div class="viewcode-block" id="PhysicalProcess.find_unknownfractions"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.find_unknownfractions">[docs]</a>    <span class="k">def</span> <span class="nf">find_unknownfractions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># x = 1 balance</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute unknown fractions &#39;x&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        physical process : Instance of ~.PhysicalProcess</span>
<span class="sd">            Physical process for which &#39;x&#39; are to be computed</span>
<span class="sd">        streamname : instance of ~.PhysicalProcess.Stream, default = None</span>
<span class="sd">            A specific stream of the PhysicalProcess for which &#39;x&#39; is to</span>
<span class="sd">            be computed. If this parameter is not provided, all streams</span>
<span class="sd">            of the physical process are considered for finding the &#39;x&#39;.</span>
<span class="sd">            </span>
<span class="sd">                              </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A list of lists. Each sublist item can take one of the following form.</span>
<span class="sd">        </span>
<span class="sd">        - If &#39;x&#39; is computable : [True, streamname, location_wherexunknown,  missingxvalue]</span>
<span class="sd">        - If &#39;x&#39; are not computable : [False, streamname, textmessage]</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Attempt is made to compute the unknown &#39;x&#39; fraction for each stream</span>
<span class="sd">        using  x = 1. This approach can only work if there is just one</span>
<span class="sd">        unknown &#39;x&#39; in a given stream.</span>
<span class="sd">                             </span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">            </span>
<span class="sd">            # Next create instance of physical process, say it is called &#39;process1&#39;</span>
<span class="sd">            &gt;&gt;&gt; process1 = pmb.PhysicalProcess(&quot;process1&quot;)</span>

<span class="sd">            # Attach three inlet streams to process1.</span>
<span class="sd">            &gt;&gt;&gt; process1.S1 = process1.attachstreams(streamnames=[&quot;S1&quot;], flowrates=[300], fractions=[[0.1, 0.3, 0.6]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S2 = process1.attachstreams(streamnames=[&quot;S2&quot;], flowrates=[200], fractions=[[0.1, 0.12, &quot;x&quot;]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S3 = process1.attachstreams(streamnames=[&quot;S3&quot;], flowrates=[700], fractions=[[0.1, &quot;x&quot;, &quot;x&quot;]])</span>
<span class="sd">            </span>
<span class="sd">            # Apply the find_unknownfractions() method on the process</span>
<span class="sd">            &gt;&gt;&gt; unknownx = process1.find_unknownfractions()</span>
<span class="sd">            &gt;&gt;&gt; print(unknownx)</span>
<span class="sd">            Output is:</span>
<span class="sd">            [[False, &#39;S1&#39;, &#39;There are no missing fractions.&#39;], [True, &#39;S2&#39;, 2, 0.78], [False, &#39;S3&#39;, &quot;More than one &#39;x&#39; unknown fractions in the stream. x = 1 is insufficient to find them.&quot;]]</span>
<span class="sd">                </span>
<span class="sd">            # Apply the find_unknownfractions() method on one of the process stream</span>
<span class="sd">            &gt;&gt;&gt; unkn = process1.find_unknownfractions(streamname=&quot;S1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(unkn)</span>
<span class="sd">            Output is:</span>
<span class="sd">            [[False, &#39;S1&#39;, &#39;There are no missing fractions.&#39;]]</span>
<span class="sd">  </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Case: Apply to all streams</span>
        <span class="n">unknownx_detailsfound</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">streamname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">strname</span><span class="p">,</span> <span class="n">streamobject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">missingx</span> <span class="o">=</span> <span class="n">streamobject</span><span class="o">.</span><span class="n">_calc_missing_xfraction</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">location_wherexunknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">streamobject</span><span class="o">.</span><span class="n">fractions</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="n">unknownx_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="n">strname</span><span class="p">,</span> <span class="n">location_wherexunknown</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">unknownx_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="n">strname</span><span class="p">,</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1"># Case: Apply balance to single stream when &#39;streamname&#39; provided in the method argument</span>
        <span class="k">elif</span> <span class="n">streamname</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">streamobject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">streamname</span><span class="p">]</span>
            <span class="n">missingx</span> <span class="o">=</span> <span class="n">streamobject</span><span class="o">.</span><span class="n">_calc_missing_xfraction</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">location_wherexunknown</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">streamobject</span><span class="o">.</span><span class="n">fractions</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span> <span class="o">==</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
                <span class="n">unknownx_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">location_wherexunknown</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">unknownx_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="n">streamname</span><span class="p">,</span> <span class="n">missingx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">unknownx_detailsfound</span></div>
          

    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------    </span>
<div class="viewcode-block" id="PhysicalProcess.update_streamfractions"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.update_streamfractions">[docs]</a>    <span class="k">def</span> <span class="nf">update_streamfractions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_fractioninfo</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update mole/mass fraction of a stream.</span>
<span class="sd">        </span>
<span class="sd">        This method should be used after finding unknown &#39;x&#39; using</span>
<span class="sd">        &#39;find_unknownfractions&#39;.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_fractioninfo : `list`</span>
<span class="sd">            A list containing information to update stream fractions.</span>
<span class="sd">            </span>
<span class="sd">            The form of the list is:</span>
<span class="sd">            - [True, streamname, location_wherexunknown, missingx_value]</span>
<span class="sd">            - [False, streamname, missingx_value]</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">       </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">            </span>
<span class="sd">            # Next create instance of physical process, say it is called &#39;process1&#39;</span>
<span class="sd">            &gt;&gt;&gt; process1 = pmb.PhysicalProcess(&quot;process1&quot;)</span>

<span class="sd">            # Attach three inlet streams to process1.</span>
<span class="sd">            &gt;&gt;&gt; process1.S1 = process1.attachstreams(streamnames=[&quot;S1&quot;], flowrates=[300], fractions=[[0.1, 0.3, 0.6]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S2 = process1.attachstreams(streamnames=[&quot;S2&quot;], flowrates=[200], fractions=[[0.1, 0.12, &quot;x&quot;]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S3 = process1.attachstreams(streamnames=[&quot;S3&quot;], flowrates=[700], fractions=[[0.1, &quot;x&quot;, &quot;x&quot;]])</span>
<span class="sd">            </span>
<span class="sd">            # Apply the find_unknownfractions() method on the process</span>
<span class="sd">            &gt;&gt;&gt; unknownx = process1.find_unknownfractions()</span>
<span class="sd">            &gt;&gt;&gt; print(unknownx)</span>
<span class="sd">            Output is:</span>
<span class="sd">            [[False, &#39;S1&#39;, &#39;There are no missing fractions.&#39;], [True, &#39;S2&#39;, 2, 0.78], [False, &#39;S3&#39;, &quot;More than one &#39;x&#39; unknown fractions in the stream. x = 1 is insufficient to find them.&quot;]]</span>
<span class="sd">            </span>
<span class="sd">            # Use unknownx to update streams</span>
<span class="sd">            &gt;&gt;&gt; process1.update_streamfractions(unknownx)</span>
<span class="sd">            Output is :</span>
<span class="sd">            For  &quot; process1 &quot; : the stream &quot; S1 &quot; There are no missing fractions.</span>
<span class="sd">            For  &quot; process1 &quot; : the stream &quot; S2 &quot; The new component fraction @ position = &quot; 2 &quot; is now =  0.78</span>
<span class="sd">            For  &quot; process1 &quot; : the stream &quot; S3 &quot; More than one &#39;x&#39; unknown fractions in the stream. x = 1 is insufficient to find them.</span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.find_unknownfractions</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">new_fractioninfo</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">fractions</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For &quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;: the stream&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;The new component fraction @ position =&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;is now = &quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For &quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;: the stream&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>
 
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------- </span>
<div class="viewcode-block" id="PhysicalProcess.find_unknownflowrate"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.find_unknownflowrate">[docs]</a>    <span class="k">def</span> <span class="nf">find_unknownflowrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Fin + Fout = 0</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute unknown flowrate &quot;F&quot; or &quot;-F&quot;.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        physical process : Instance of ~.PhysicalProcess</span>
<span class="sd">            Physical process for which &#39;F&#39;/&#39;-F&#39; are to be computed.            </span>
<span class="sd">                              </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A list. Each list can take one of the following form.</span>
<span class="sd">        </span>
<span class="sd">        - If &#39;F&#39;/&#39;-F&#39; is computable : [[True, streamname, missingflowrate_value]]</span>
<span class="sd">        - If &#39;F&#39;/&#39;-F&#39; is not computable : [[False, textmessage]]</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Attempt is made to compute the unknown flowrate for a process</span>
<span class="sd">        using  # Fin + Fout = 0. This approach can only work if there is</span>
<span class="sd">        just one unknown &#39;F&#39; or &#39;-F&#39; in a given process.</span>
<span class="sd">                             </span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">            </span>
<span class="sd">            # Next create instance of physical process, say it is called &#39;process1&#39;</span>
<span class="sd">            &gt;&gt;&gt; process1 = pmb.PhysicalProcess(&quot;process1&quot;)</span>

<span class="sd">            # Attach two inlet streams and one outlet stream to process1.</span>
<span class="sd">            &gt;&gt;&gt; process1.S1 = process1.attachstreams(streamnames=[&quot;S1&quot;], flowrates=[300], fractions=[[0.1, 0.3, 0.6]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S2 = process1.attachstreams(streamnames=[&quot;S2&quot;], flowrates=[200], fractions=[[0.1, 0.12, &quot;x&quot;]])</span>
<span class="sd">            # The stream below is the outlet stream. Note the flowrate has a negative sign.</span>
<span class="sd">            &gt;&gt;&gt; process1.S3 = process1.attachstreams(streamnames=[&quot;S3&quot;], flowrates=[&quot;-F&quot;], fractions=[[0.1, &quot;x&quot;, &quot;x&quot;]])</span>
<span class="sd">            </span>
<span class="sd">            # Apply the find_unknownflowrate() method on the process</span>
<span class="sd">            &gt;&gt;&gt; unknownF = process1.find_unknownflowrate()</span>
<span class="sd">            &gt;&gt;&gt; print(unknownF)</span>
<span class="sd">            Output is:</span>
<span class="sd">            [[True, &#39;S3&#39;, -500.0]]</span>
<span class="sd">                        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unknownflowrate_detailsfound</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plusF_location</span><span class="p">,</span> <span class="n">minusF_location</span><span class="p">,</span> <span class="n">x_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_unknownxandFlocations</span><span class="p">()</span>
        <span class="n">unknownplusF_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">plusF_location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">unknownminusF_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">minusF_location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">unknownplusF_count</span> <span class="o">+</span> <span class="n">unknownminusF_count</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">:</span>
                <span class="n">knownflowrates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">flow</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="k">if</span> <span class="p">(</span><span class="n">flow</span> <span class="o">!=</span> <span class="s2">&quot;F&quot;</span> <span class="ow">and</span> <span class="n">flow</span> <span class="o">!=</span> <span class="s2">&quot;-F&quot;</span><span class="p">)]</span>
                <span class="n">sumof_knownflowrates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">knownflowrates</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
                <span class="c1"># Fsum = np.sum(np.array([float(flow[0]) for flow in self.npflowrates if (flow != &quot;F&quot; and flow != &quot;-F&quot;)]).astype(float))</span>
                <span class="n">missingflowrate</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">sumof_knownflowrates</span><span class="p">)</span> <span class="c1"># because F = 0</span>
                <span class="k">if</span> <span class="n">unknownplusF_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">streamwith_unknownflowrate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span><span class="p">[(</span><span class="n">plusF_location</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">unknownminusF_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">streamwith_unknownflowrate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span><span class="p">[(</span><span class="n">minusF_location</span><span class="p">)]</span>
                <span class="c1"># print(&quot;name and missing flowrate&quot;, streamwith_unknownflowrate, missingflowrate) </span>
                <span class="n">unknownflowrate_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="n">streamwith_unknownflowrate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">missingflowrate</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">unknownflowrate_detailsfound</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">unknownplusF_count</span> <span class="o">+</span> <span class="n">unknownminusF_count</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;More than one &#39;F&#39;/&#39;-F&#39; unknown flowrates in stream. Try the &#39;solvesystem&#39; method&quot;</span>
            <span class="n">unknownflowrate_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">unknownflowrate_detailsfound</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">unknownplusF_count</span> <span class="o">+</span> <span class="n">unknownminusF_count</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;There are no missing flowrates&quot;</span>
            <span class="n">unknownflowrate_detailsfound</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">unknownflowrate_detailsfound</span></div>


    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#--------------------------------------------     </span>
<div class="viewcode-block" id="PhysicalProcess.update_streamflowrates"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.update_streamflowrates">[docs]</a>    <span class="k">def</span> <span class="nf">update_streamflowrates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newflow</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update flowrate of a stream.</span>
<span class="sd">        </span>
<span class="sd">        This method should be used after finding unknown &#39;x&#39; using</span>
<span class="sd">        &#39;find_unknownflowrate&#39;.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_flow : `list`</span>
<span class="sd">            A list containing information to update stream fractions.</span>
<span class="sd">            </span>
<span class="sd">            The form of the list is:</span>
<span class="sd">            - [[False, textmessage]]</span>
<span class="sd">            - [[True, streamname, missingflowrate_value]]</span>
<span class="sd">                              </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">       </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">            </span>
<span class="sd">            # Next create instance of physical process, say it is called &#39;process1&#39;</span>
<span class="sd">            &gt;&gt;&gt; process1 = pmb.PhysicalProcess(&quot;process1&quot;)</span>

<span class="sd">            # Attach two inlet streams and one outlet stream to process1.</span>
<span class="sd">            &gt;&gt;&gt; process1.S1 = process1.attachstreams(streamnames=[&quot;S1&quot;], flowrates=[300], fractions=[[0.1, 0.3, 0.6]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S2 = process1.attachstreams(streamnames=[&quot;S2&quot;], flowrates=[200], fractions=[[0.1, 0.12, &quot;x&quot;]])</span>
<span class="sd">            # The stream below is the outlet stream. Note the flowrate has a negative sign.</span>
<span class="sd">            &gt;&gt;&gt; process1.S3 = process1.attachstreams(streamnames=[&quot;S3&quot;], flowrates=[&quot;-F&quot;], fractions=[[0.1, &quot;x&quot;, &quot;x&quot;]])</span>
<span class="sd">            </span>
<span class="sd">            # Apply the find_unknownflowrate() method on the process</span>
<span class="sd">            &gt;&gt;&gt; unknownF = process1.find_unknownflowrate()</span>
<span class="sd">            &gt;&gt;&gt; process1.update_streamflowrates(unknownF)</span>
<span class="sd">            Output is:</span>
<span class="sd">            For  &quot; process1 &quot; : the stream &quot; S3 &quot; has new flowrate = -500.0</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.find_unknownflowrate</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(newflow)</span>
        <span class="k">for</span> <span class="n">streamdata</span> <span class="ow">in</span> <span class="n">newflow</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">streamdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">streamregistry</span><span class="p">[</span><span class="n">streamdata</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">flowrate</span><span class="o">=</span><span class="n">streamdata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For &quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;: the stream&quot;</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">streamdata</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;has new flowrate =&quot;</span><span class="p">,</span> <span class="n">streamdata</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">streamdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For &quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">streamdata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>
                


    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------</span>
<div class="viewcode-block" id="PhysicalProcess.perform_component_massbalance"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.perform_component_massbalance">[docs]</a>    <span class="k">def</span> <span class="nf">perform_component_massbalance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Execute component mass balance on a process.</span>
<span class="sd">        </span>
<span class="sd">        :math:`(F_ix_{i,component})` = 0; where i = stream index</span>
<span class="sd">        </span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        physical process : Instance of ~.PhysicalProcess</span>
<span class="sd">            Physical process for which component mass balance is to be performed.       </span>
<span class="sd">                              </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.find_unknownflowrate</span>
<span class="sd">        pychemengg.massbalances.physicalmassbalance.PhysicalProcess.find_unknownfractions</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        **Logic for component mass balance**</span>

<span class="sd">        </span>
<span class="sd">        The nparray of stream flowrates has shape (n,1):</span>
<span class="sd">            </span>
<span class="sd">        - n : number of streams</span>
<span class="sd">                </span>

<span class="sd">        The nparray of stream flowrates has shape (n,m): </span>
<span class="sd">            </span>
<span class="sd">        - n : number of streams</span>
<span class="sd">        - m : number of components per stream</span>
<span class="sd">                </span>

<span class="sd">        </span>
<span class="sd">        For example consider three streams:</span>
<span class="sd">        </span>
<span class="sd">        ==================   ============   =================</span>
<span class="sd">        Stream               Flowrate       Fractions</span>
<span class="sd">        ==================   ============   =================</span>
<span class="sd">        Inlet 1              F1             [x11, x12, x13]</span>
<span class="sd">        Inlet 2              F2             [x21, x22, x23]</span>
<span class="sd">        Outlet 3             F3             [x31, x32, x33]</span>
<span class="sd">        ==================   ============   =================</span>

<span class="sd">        The nparray for flowrates is:</span>
<span class="sd">            </span>
<span class="sd">            A = </span>
<span class="sd">            </span>
<span class="sd">            [[F1]</span>
<span class="sd">             </span>
<span class="sd">            [F2]</span>
<span class="sd">             </span>
<span class="sd">            [F3]] </span>
<span class="sd">             </span>
<span class="sd">            shape = (3, 1)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        The nparray for component fractions is:</span>
<span class="sd">            </span>
<span class="sd">            B =</span>
<span class="sd">            </span>
<span class="sd">            [[x11, x12, x13]</span>
<span class="sd">            </span>
<span class="sd">            [x21, x22, x23]</span>
<span class="sd">            </span>
<span class="sd">            [x31, x32, x33]] </span>
<span class="sd">            </span>
<span class="sd">            shape = (3, 3)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :math:`x_{m,n}` : </span>
<span class="sd">            </span>
<span class="sd">            - m : stream index</span>
<span class="sd">            - n : component index</span>
<span class="sd">        </span>
<span class="sd">        To perform component mass balance, the row of matrix &#39;A&#39; is multiplied</span>
<span class="sd">        to row of matrix &#39;B&#39; </span>
<span class="sd">        </span>
<span class="sd">        C = </span>
<span class="sd">        </span>
<span class="sd">        [[F1*x11, F1*x12, F1*x13]</span>
<span class="sd">        </span>
<span class="sd">        [F2*x21, F2*x22, F2*x23]</span>
<span class="sd">        </span>
<span class="sd">        [F3*x31, F3*x32, F3*x33]]</span>
<span class="sd">        </span>
<span class="sd">        Each column of &#39;C&#39; represents flowrate of a component.</span>
<span class="sd">        By summing the column of &#39;C&#39; the component mass balance can be</span>
<span class="sd">        performed. </span>
<span class="sd">        </span>
<span class="sd">        - Sum of column 1 = Flowrate balance for component 1</span>
<span class="sd">        - Sum of column 2 = Flowrate balance for component 2</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from pychemengg.massbalances import physicalmassbalance as pmb</span>
<span class="sd">            </span>
<span class="sd">            # Next create instance of physical process, say it is called &#39;process1&#39;</span>
<span class="sd">            &gt;&gt;&gt; process1 = pmb.PhysicalProcess(&quot;process1&quot;)</span>

<span class="sd">            # Attach two inlet streams and one outlet stream to process1.</span>
<span class="sd">            &gt;&gt;&gt; process1.S1 = process1.attachstreams(streamnames=[&quot;S1&quot;], flowrates=[300], fractions=[[0.4333, 0.3, 0.2667]])</span>
<span class="sd">            &gt;&gt;&gt; process1.S2 = process1.attachstreams(streamnames=[&quot;S2&quot;], flowrates=[200], fractions=[[0.1, 0.12, 0.78]])</span>
<span class="sd">            # The stream below is the outlet stream. Note the flowrate has a negative sign.</span>
<span class="sd">            &gt;&gt;&gt; process1.S3 = process1.attachstreams(streamnames=[&quot;S3&quot;], flowrates=[-500], fractions=[[0.3, 0.228, 0.472]])</span>
<span class="sd">            </span>
<span class="sd">            # Apply the perform_component_massbalance() method on the process</span>
<span class="sd">            &gt;&gt;&gt; componentbalance = process1.perform_component_massbalance()</span>
<span class="sd">            &gt;&gt;&gt; print(&quot;component balance: &quot;, componentbalance)</span>
<span class="sd">            Output is:</span>
<span class="sd">            component balance:  [-0.01  0.    0.01]</span>
<span class="sd">            # This means that:</span>
<span class="sd">            # For component 1: Fx = -0.01</span>
<span class="sd">            # For component 2: Fx = 0.</span>
<span class="sd">            # For component 3: Fx = 0.01</span>
<span class="sd">            # The above balance can be set up as part of a function to solve</span>
<span class="sd">            # for unknown &quot;F&quot;, &quot;-F&quot;, and &quot;x&quot;. See &#39;User Tutorial&#39;</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Performs (Fx )in = (Fx)out for each component</span>
        <span class="c1"># Returns numpy array of mass balance for each component</span>
        <span class="c1"># if the process is uniquely defined then these terms will</span>
        <span class="c1"># be close to zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_numpyarraysof_streamdata</span><span class="p">()</span>
        <span class="c1"># print(self.npflowrates, &quot;\n shape =&quot;, self.npflowrates.shape)</span>
        <span class="c1"># print(&quot;\n&quot;,self.npfractions, &quot;\n shape =&quot;, self.npfractions.shape)</span>
        <span class="n">npcomponent_massbalance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># THIS IS ALTERNATE CODE</span>
        <span class="c1">#------------------------</span>
        <span class="c1"># npstream_flowandfraction_data = [[np.array(streamobject.flowrate),np.array(streamobject.fractions)]</span>
        <span class="c1">#                for streamname, streamobject in self.streamregistry.items()]</span>
        <span class="c1"># component_mass = [numpyFlow * numpyFractions for numpyFlow, numpyFractions in npstream_flowandfraction_data]</span>
        <span class="c1"># npcomponent_mass = np.array(component_mass)</span>
        <span class="c1"># npcomponent_massbalance = npcomponent_mass.sum(axis=0) </span>
        
        <span class="k">return</span> <span class="n">npcomponent_massbalance</span> <span class="c1"># return type &lt;class &#39;numpy.ndarray&#39;&gt; ... 1 x n array</span></div>
    
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#----------------------------------------- </span>
    <span class="k">def</span> <span class="nf">_find_unknownxandFlocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Find where &#39;F&#39;, &#39;-F&#39;, &#39;x&#39; are located in different streams.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plusF_location : tuple (nparray of `int`)</span>
<span class="sd">            Column numbers of array &#39;npflowrates&#39; where &quot;F&quot; is located.</span>
<span class="sd">        minusF_location : tuple (nparray of `int`)</span>
<span class="sd">            Column numbers of array &#39;npflowrates&#39; where &quot;-F&quot; is located.</span>
<span class="sd">        x_location : tuple (nparray of `int`, nparray of `int`)</span>
<span class="sd">            First nparray of tuple has row index, second nparray of tuple has column index</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_numpyarraysof_streamdata</span><span class="p">()</span>
        <span class="n">plusF_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_whereplusFs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">)</span>
        <span class="n">minusF_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_whereminusFs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">)</span>
        <span class="n">x_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_wherexs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">plusF_location</span><span class="p">,</span> <span class="n">minusF_location</span><span class="p">,</span> <span class="n">x_location</span><span class="p">)</span>  
    
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------   </span>
    <span class="k">def</span> <span class="nf">_getsignof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Find sign of the flowrate of a stream.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">F</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">F</span> <span class="o">==</span> <span class="s2">&quot;-F&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">F</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">F</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            
            
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------  </span>
<div class="viewcode-block" id="PhysicalProcess.degreesoffreedom"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.degreesoffreedom">[docs]</a>    <span class="k">def</span> <span class="nf">degreesoffreedom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Perform degree of freedom analysis on the physical process.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None : Method is applied to the physical process.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : None. </span>
<span class="sd">            Multiple &quot;self&quot; attributes are created. These are used to</span>
<span class="sd">            formulate balances that are required to solve for &quot;F&quot;, &quot;-F&quot;, and &quot;x&quot;</span>
<span class="sd">        </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        unknown_x_count : `int`</span>
<span class="sd">            Count of total unknown fractions in streams attached to the process.</span>
<span class="sd">        unknownplusF_count : `int`</span>
<span class="sd">            Count of total unknown inlet stream flowrates.</span>
<span class="sd">        unknownminusF_count : `int`</span>
<span class="sd">            Count of total unknown outlet stream flowrates.</span>
<span class="sd">        unknown_Fs_count : `int`</span>
<span class="sd">            Count of total unknown inlet + outlet stream flowrates.</span>
<span class="sd">        totalunknowns : `int`</span>
<span class="sd">            Sum of unknown_Fs_count + unknown_x_count</span>
<span class="sd">        extrainfo_count : `int`</span>
<span class="sd">            Count of total extra information available for the process.</span>
<span class="sd">        component_count : `int`</span>
<span class="sd">            Total components in the process streams</span>
<span class="sd">        streamswith_unknownx_count : `int`</span>
<span class="sd">            Count of streams that contain at least one unknown component fraction.</span>
<span class="sd">        totalequations_possible : `int`</span>
<span class="sd">            Sum of extrainfo_count + component_count + streamswith_unknownx_count</span>
<span class="sd">      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_numpyarraysof_streamdata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plusF_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minusF_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_unknownxandFlocations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknownplusF_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plusF_location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknownminusF_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minusF_location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownplusF_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownminusF_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_extrainfo</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_count</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_records</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streamswith_unknownx_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>        
        <span class="c1"># When there are multiple processes, it is possible</span>
        <span class="c1"># some of them may have fewer components in their streams.</span>
        <span class="c1"># Find if a component(s) has &quot;0&quot; fractions in all streams.</span>
        <span class="c1"># If, yes, subtract it from self.component_count</span>
        <span class="n">iscolumn_with_all_xfractions_equalto_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">countofcolumns_with_all_xfractions_equalto_0</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">iscolumn_with_all_xfractions_equalto_0</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">countofcolumns_with_all_xfractions_equalto_0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">component_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_count</span> <span class="o">-</span> <span class="n">countofcolumns_with_all_xfractions_equalto_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamswith_unknownx_count</span>

        <span class="n">beginning_text</span> <span class="o">=</span> <span class="s2">&quot;Degrees of freedom analysis for &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beginning_text</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">beginning_text</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beginning_text</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of unknown flowrates :--&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of unknown &#39;x&#39; fractions :--&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total unknowns :--&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total possible component balances (Fx)in = (Fx)out :--&gt; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_count</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total possible sum of stream fractions is unity balances (x) = 1 :--&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamswith_unknownx_count</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Other extra equations :--&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_count</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total equations :--&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">System is underspecified because there are more unknowns than available equations&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">There are = &quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="p">,</span> <span class="s2">&quot;unknowns and&quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span> <span class="p">,</span> <span class="s2">&quot;possible equations&quot;</span><span class="p">)</span>
            <span class="n">ending_text</span> <span class="o">=</span> <span class="s2">&quot;End of degree of freedom analysis for &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ending_text</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ending_text</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">()</span> <span class="c1"># leave an empty line</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">System can be solved&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">There are = &quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="p">,</span> <span class="s2">&quot;unknowns and&quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span> <span class="p">,</span> <span class="s2">&quot;possible equations&quot;</span><span class="p">)</span>
            <span class="n">ending_text</span> <span class="o">=</span> <span class="s2">&quot;End of degree of freedom analysis for &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ending_text</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ending_text</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ending_text</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># leave an empty line</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">It maybe possible to solve the system&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">There are = &quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="p">,</span> <span class="s2">&quot;unknowns and&quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span> <span class="p">,</span> <span class="s2">&quot;possible equations&quot;</span><span class="p">)</span>
            <span class="n">ending_text</span> <span class="o">=</span> <span class="s2">&quot;End of degree of freedom analysis for &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ending_text</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ending_text</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ending_text</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># leave an empty line</span>
            <span class="k">return</span> <span class="kc">None</span></div>
    
    
    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_solvedsystem_summary</span><span class="p">(</span><span class="n">processname</span><span class="p">,</span> <span class="n">npstreamnames</span><span class="p">,</span>
                                     <span class="n">npflowrates</span><span class="p">,</span> <span class="n">npfractions</span><span class="p">,</span> <span class="n">extrainfos</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Creates the solution object of the physical process being solved.</span>
<span class="sd">        </span>
<span class="sd">        The object created is an instance of PhysicalProcess class.</span>
<span class="sd">        Different streams tat are originally associated with the process</span>
<span class="sd">        that is being solved get attached to this object with all known </span>
<span class="sd">        quantities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;SOLUTION TO &quot;</span>  <span class="o">+</span> <span class="n">processname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">solvedsystem</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">strmName</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">npstreamnames</span><span class="p">):</span>
            
            <span class="c1"># The following is a hack to attachstreams and create .streamname attribute</span>
            <span class="c1">#--------------------------------------------------------------------------</span>
            <span class="c1"># headerstring = &quot;solvedsystem.&quot;+strmName[0]+&quot;= solvedsystem.attachstreams(streamnames=[&quot;+&quot;&quot;&quot;strmName[0]]&quot;&quot;&quot;+&quot; )&quot;</span>
            <span class="c1"># exec(headerstring)</span>
            <span class="c1"># Then Assign flowrate and fractions to streamobject</span>
            <span class="c1"># solvedsystem.streamregistry[strmName[0]].flowrate = npflowrates[num][0]</span>
            <span class="c1"># solvedsystem.streamregistry[strmName[0]].fractions = npfractions[num]</span>
            
            <span class="c1"># if len(extrainfos[num]) &gt; 0:</span>
            <span class="c1">#     solvedsystem.streamregistry[strmName[0]].extrainfo = extrainfos[num]</span>
            
            <span class="c1"># Following is a much cleaner way</span>
            <span class="c1">#----------------------------------</span>
            <span class="c1"># First create streams</span>
            <span class="n">streamobject</span> <span class="o">=</span> <span class="n">solvedsystem</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="n">strmName</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> 
                                                      <span class="n">flowrates</span><span class="o">=</span><span class="n">npflowrates</span><span class="p">[</span><span class="n">num</span><span class="p">],</span> 
                                                      <span class="n">fractions</span><span class="o">=</span><span class="p">[</span><span class="n">npfractions</span><span class="p">[</span><span class="n">num</span><span class="p">]],</span>
                                                      <span class="n">extrainfos</span><span class="o">=</span><span class="p">[</span><span class="n">extrainfos</span><span class="p">[</span><span class="n">num</span><span class="p">]])</span>
            
            <span class="c1"># Reason why [  ] is placed around some parameters</span>
            <span class="c1">#--------------------------------------------------            </span>
            <span class="c1"># print(strmName[0]) :--&gt; output is &#39;S2&#39; </span>
            <span class="c1"># streamnames needs a LIST as input, so use [ strmName[0] ]</span>
            
            <span class="c1"># print(npflowrates[num]) :--&gt; output is [-3972.33]</span>
            <span class="c1"># flowrates needs a LIST, and this is already a list so NO CHANGE</span>
            
            <span class="c1"># print(npfractions[num]) :--&gt; output is [0.0, 1.0]</span>
            <span class="c1"># fractions needs a LIST of LIST as input, so use [ npfractions[num] ]</span>
            
            <span class="c1"># print(extrainfos[num]) :--&gt; output is []</span>
            <span class="c1"># extrainfos needs a LIST of LIST as input, so use [ extrainfos[num] ]</span>
            
            <span class="c1"># Next set attribute such as mixer1.S1 = streamobject</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">solvedsystem</span><span class="p">,</span> <span class="n">strmName</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">streamobject</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solvedsystem</span>
        

    <span class="c1"># Method for outer class &quot;PhysicalProcess&quot;</span>
    <span class="c1">#-----------------------------------------           </span>
<div class="viewcode-block" id="PhysicalProcess.solvesystem"><a class="viewcode-back" href="../../../_autosummary/pychemengg.massbalances.physicalmassbalance.PhysicalProcess.html#pychemengg.massbalances.physicalmassbalance.PhysicalProcess.solvesystem">[docs]</a>    <span class="k">def</span> <span class="nf">solvesystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Solves the physical process to find &quot;F&quot;, &quot;-F&quot;, and &quot;x&quot;</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None : Apply the method to the physical process to be solved.</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        solution : Instance of the class PhysicalProcess</span>
<span class="sd">            A new instance of PhysicalProcess is created that</span>
<span class="sd">            stores the solution. The solution can be printed.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span> 
        <span class="c1"># Perform degrees of freedom analysis</span>
        <span class="c1"># This executes code that will create</span>
        <span class="c1"># many of the &quot;self.variables&quot; that are needed for</span>
        <span class="c1"># analysis below.</span>

        <span class="c1"># Method inner to solvesystem()</span>
        <span class="c1">#-------------------------------</span>
        <span class="k">def</span> <span class="nf">_assemble_all_possible_balance_and_extrainfo_equations</span><span class="p">(</span><span class="n">guess</span><span class="p">):</span>
            <span class="c1"># This function is called to assemble and return</span>
            <span class="c1"># all possible balance equations and extrainfo equations.</span>
            <span class="c1"># If the degrees of freedom is zero, then all of them</span>
            <span class="c1"># are used to solve the system. If the degrees of freedom</span>
            <span class="c1"># is such that number of equations are greater than number</span>
            <span class="c1"># of unknowns then the system is overspecified, however,</span>
            <span class="c1"># still, if the equations are consistent, they can be used</span>
            <span class="c1"># to compute the unknowns. For this, it is important to</span>
            <span class="c1"># weed out equations that express the same relationship</span>
            <span class="c1"># and are therfore NOT UNIQUE. Only one of these &quot;non-unique&quot;</span>
            <span class="c1"># equations can be used. Furthermore, TRIVIAL equations</span>
            <span class="c1"># for which F*x terms in a component mass balance vanish</span>
            <span class="c1"># if x=0 for all the unknown &quot;F&quot; or &quot;-F&quot; terms,</span>
            <span class="c1"># should be weeded out.</span>
            <span class="c1"># This function only assembles all possible equations</span>
            <span class="c1"># and returns them to another function where this weeding out</span>
            <span class="c1"># is performed.</span>
            
            <span class="c1"># If system is underspecified, print message ---&gt; EXIT.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">System is underspecified because there are more unknowns than available equations&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">There are = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span><span class="p">,</span> <span class="s2">&quot;unknowns and&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">,</span>
                      <span class="s2">&quot;equations&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            
            <span class="c1"># If total unknowns &lt;= total equations ---&gt; PROCEED AHEAD</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalequations_possible</span><span class="p">:</span>
                <span class="n">guessindex</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># initialize index to array of guess value</span>
                
                <span class="c1"># (A) ASSIGN GUESS VALUES TO UNKNOWN VARIABLES</span>
                <span class="c1"># ---------------------------------------------</span>
                <span class="c1"># 1) First assign &#39;guess&#39; values to unknown &#39;x&#39; </span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_location</span><span class="p">)]</span> <span class="o">=</span> <span class="n">guess</span><span class="p">[</span><span class="n">guessindex</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span><span class="p">]</span>
                    <span class="n">guessindex</span> <span class="o">=</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="c1"># 2) Next assign &#39;guess&#39; values to unknown &#39;F&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownplusF_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">plusF_location</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="n">guessindex</span> <span class="p">:</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownplusF_count</span><span class="p">])</span>
                    <span class="c1"># NOTE: absolute value is used on RHS because &quot;F&quot;</span>
                    <span class="c1"># is supposed to be positive, and if the guess is</span>
                    <span class="c1"># negative, the solution may not converge.</span>
                    <span class="n">guessindex</span> <span class="o">=</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownplusF_count</span>
                <span class="c1"># 3) Next assign &#39;guess&#39; values to unknown &#39;-F&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownminusF_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">minusF_location</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">guess</span><span class="p">[</span><span class="n">guessindex</span> <span class="p">:</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownminusF_count</span><span class="p">])</span>
                    <span class="c1"># NOTE:  &quot;-&quot; absolute value is used on RHS because &quot;F&quot;</span>
                    <span class="c1"># is supposed to be negative, and if the guess is</span>
                    <span class="c1"># positive, the solution may not converge.</span>
                    <span class="n">guessindex</span> <span class="o">=</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownminusF_count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                
                <span class="c1"># (B) NEXT CREATE EQUATIONS TO ALLOW SOLUTION OF &#39;x&#39; and &#39;F&#39;/&#39;-F&#39;</span>
                <span class="c1"># --------------------------------------------------------------------</span>
                
                <span class="c1"># ----------------------------------------------                </span>
                <span class="c1"># # 1) Start by forming equations using&#39;Extra Info&#39; of streams</span>
                <span class="c1"># ----------------------------------------------</span>
                <span class="c1"># if self.extrainfo_count &gt; 0:</span>
                <span class="c1">#     extrainfoindex = 0 # initialize index into extrainfo relations</span>
                <span class="c1">#     extrarelations ={} # to store extra relation equations</span>
                <span class="c1">#     # Process extra info records</span>
                <span class="c1">#     for indx, relation in enumerate(self.extrainfo_records):</span>
                <span class="c1">#         isextrainfo_between_component_flowrates = relation[0]</span>
                <span class="c1">#         left_streamsign = relation[1]</span>
                <span class="c1">#         left_streamname = relation[2]</span>
                <span class="c1">#         ratio = relation[3]</span>
                <span class="c1">#         right_streamsign = relation[4]</span>
                <span class="c1">#         right_streamname = relation[5]</span>
                <span class="c1">#         left_streamflow = self.npflowrates[np.where(self.npstreamnames == left_streamname)]</span>
                <span class="c1">#         right_streamflow = self.npflowrates[np.where(self.npstreamnames == right_streamname)]</span>
                <span class="c1">#         if isextrainfo_between_component_flowrates == False: # then extrainfo is between components of streams</span>
                <span class="c1">#             if left_streamsign * right_streamsign &gt; 0: # both streams are either &#39;+&#39;:inlet or &#39;-&#39;:outlet</span>
                <span class="c1">#                 extrarelations[extrainfoindex] = left_streamsign*abs(left_streamflow) - right_streamsign * abs(((eval(ratio) * right_streamflow)))</span>
                <span class="c1">#                 extrainfoindex = extrainfoindex + 1</span>
                <span class="c1">#             if left_streamsign * right_streamsign &lt; 0: # one stream is &#39;+&#39;:inlet other is &#39;-&#39;:outlet</span>
                <span class="c1">#                 extrarelations[extrainfoindex] = (left_streamsign*(left_streamflow)) - abs(right_streamsign * (((eval(ratio) * right_streamflow))))</span>
                <span class="c1">#                 extrainfoindex = extrainfoindex + 1</span>
                <span class="c1">#         if isextrainfo_between_component_flowrates != False: # then extra relationship is between total stream flowrates</span>
                <span class="c1">#             column_coordinate = int(isextrainfo_between_component_flowrates[0])-1</span>
                <span class="c1">#             left_rowcoordinate = (np.where(self.npstreamnames == left_streamname))</span>
                <span class="c1">#             right_rowcoordinate = (np.where(self.npstreamnames == right_streamname)) </span>
                <span class="c1">#             left_streamfraction = self.npfractions[left_rowcoordinate[0][0], column_coordinate]</span>
                <span class="c1">#             right_streamfraction = self.npfractions[right_rowcoordinate[0][0], column_coordinate]</span>
                <span class="c1">#             if left_streamsign * right_streamsign &gt; 0: # both streams are either &#39;+&#39;:inlet or &#39;-&#39;:outlet</span>
                <span class="c1">#                 extrarelations[extrainfoindex] = left_streamsign*abs(left_streamfraction * left_streamflow) - right_streamsign * abs(eval(ratio) * right_streamfraction * right_streamflow) </span>
                <span class="c1">#                 extrainfoindex = extrainfoindex + 1</span>
                <span class="c1">#             if left_streamsign * right_streamsign &lt; 0: # one stream is &#39;+&#39;:inlet other is &#39;-&#39;:outlet</span>
                <span class="c1">#                 extrarelations[extrainfoindex] = left_streamsign*(left_streamfraction * left_streamflow) - abs(right_streamsign * eval(ratio) * right_streamfraction * right_streamflow) </span>
                <span class="c1">#                 extrainfoindex = extrainfoindex + 1</span>
                <span class="c1"># --------------------------------------------------</span>
                <span class="c1"># The code above ensures that equations can be solved.</span>
                <span class="c1"># The &lt; 0 and &lt; 0 conditions are imposed</span>
                <span class="c1"># However by forcing &#39;-&#39; or &#39;+&#39; sign to guess variables while</span>
                <span class="c1"># they are assigned to &quot;-F&quot; or &quot;F&quot; unknowns, this appears</span>
                <span class="c1"># to be no longer required. However, until more testing is</span>
                <span class="c1"># done, the above code is retained in case it is needed again.</span>
                
                <span class="c1"># 1) Start by forming equations using&#39;Extra Info&#39; of streams</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">extrainfoindex</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># initialize index into extrainfo relations</span>
                    <span class="n">extrarelations</span> <span class="o">=</span><span class="p">{}</span> <span class="c1"># to store extra relation equations</span>
                    <span class="c1"># Process extra info records</span>
                    <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">relation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_records</span><span class="p">):</span>
                        <span class="n">isextrainfo_between_component_flowrates</span> <span class="o">=</span> <span class="n">relation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">left_streamsign</span> <span class="o">=</span> <span class="n">relation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">left_streamname</span> <span class="o">=</span> <span class="n">relation</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">ratio</span> <span class="o">=</span> <span class="n">relation</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">right_streamsign</span> <span class="o">=</span> <span class="n">relation</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">right_streamname</span> <span class="o">=</span> <span class="n">relation</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                        <span class="n">left_streamflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span> <span class="o">==</span> <span class="n">left_streamname</span><span class="p">)]</span>
                        <span class="n">right_streamflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span> <span class="o">==</span> <span class="n">right_streamname</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="n">isextrainfo_between_component_flowrates</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># then extrainfo is between total stream flowrates</span>
                            <span class="n">extrarelations</span><span class="p">[</span><span class="n">extrainfoindex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left_streamflow</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(((</span><span class="nb">eval</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span> <span class="o">*</span> <span class="n">right_streamflow</span><span class="p">)))</span>
                            <span class="n">extrainfoindex</span> <span class="o">=</span> <span class="n">extrainfoindex</span> <span class="o">+</span> <span class="mi">1</span>                            
                        <span class="k">if</span> <span class="n">isextrainfo_between_component_flowrates</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># then extra relationship is between flowrates of components</span>
                            <span class="n">column_coordinate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">isextrainfo_between_component_flowrates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
                            <span class="n">left_rowcoordinate</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span> <span class="o">==</span> <span class="n">left_streamname</span><span class="p">))</span>
                            <span class="n">right_rowcoordinate</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span> <span class="o">==</span> <span class="n">right_streamname</span><span class="p">))</span> 
                            <span class="n">left_streamfraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">[</span><span class="n">left_rowcoordinate</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">column_coordinate</span><span class="p">]</span>
                            <span class="n">right_streamfraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">[</span><span class="n">right_rowcoordinate</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">column_coordinate</span><span class="p">]</span>
                            <span class="n">extrarelations</span><span class="p">[</span><span class="n">extrainfoindex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left_streamfraction</span> <span class="o">*</span> <span class="n">left_streamflow</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span> <span class="o">*</span> <span class="n">right_streamfraction</span> <span class="o">*</span> <span class="n">right_streamflow</span><span class="p">)</span> 
                            <span class="n">extrainfoindex</span> <span class="o">=</span> <span class="n">extrainfoindex</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># 2) Create the component/species balance: (Fx)in - (Fx)out = 0</span>
                <span class="n">componentmassbalance</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># 3) Create the component fraction balance: (x) = 0</span>
                <span class="n">componentmassfractionbalance</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                
                <span class="c1"># (C) NEXT ASSEMBLE EQUATIONS</span>
                <span class="c1"># ---------------------------</span>
                <span class="c1"># These are equations that contain &#39;x&#39; and &#39;+F&#39;/&#39;-F&#39; and </span>
                <span class="c1"># will be solved using a solver</span>
                <span class="n">vareqindex</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index for number of equations assembled</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var_equations_registry</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Registry to store equation information</span>
                <span class="c1"># KEY: tuple of :</span>
                <span class="c1"># (&quot;extrainfo&quot;,count) --&gt; tracks extrainfo equations</span>
                <span class="c1"># (&quot;componentbalance&quot;, column number) --&gt; tracks component balance equations</span>
                <span class="c1"># (&quot;fractionbalance&quot;, row number) --&gt; tracks fraction balance equations</span>
                
                <span class="c1"># 1) Start by assembling &#39;EXTRA INFO&#39; equations      </span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrainfo_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">equation</span> <span class="ow">in</span> <span class="n">extrarelations</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="n">dict_key</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;extrainfo&quot;</span><span class="p">,</span> <span class="n">vareqindex</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">var_equations_registry</span><span class="p">[</span><span class="n">dict_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">equation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">vareqindex</span> <span class="o">=</span> <span class="n">vareqindex</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># 2) Next assemble equations involving component mass/mole balances</span>
                <span class="c1"># Fixi = 0 for each component i</span>
                <span class="c1"># Assemble this equation ONLY if at least one &#39;x&#39; or &#39;F&#39;/&#39;-F&#39;</span>
                <span class="c1"># is unknown</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">columns_used_in_componentbalance_equations</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># to track columns used</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rowcontaining_unknownx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">columncontaining_unknownx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># x_location stores &#39;row&#39; and &#39;column&#39; numbers where &#39;x&#39; exists</span>
                    <span class="n">rownumber_withunknownxcount</span> <span class="o">=</span>  <span class="n">Counter</span><span class="p">(</span><span class="n">rowcontaining_unknownx</span><span class="p">)</span>
                    <span class="n">columnnumber_withunknownxcount</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">columncontaining_unknownx</span><span class="p">)</span>
                    <span class="n">x_frequency_column_pair</span> <span class="o">=</span> <span class="p">[(</span><span class="n">column</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">columnnumber_withunknownxcount</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                    <span class="n">sorted_x_frequency_column_pair</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x_frequency_column_pair</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">frequency</span><span class="p">:</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">x_frequency_row_pair</span> <span class="o">=</span> <span class="p">[(</span><span class="n">row</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">rownumber_withunknownxcount</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                    <span class="n">sorted_x_frequency_row_pair</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x_frequency_row_pair</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">frequency</span><span class="p">:</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                      
                    <span class="k">for</span> <span class="n">column_location</span><span class="p">,</span> <span class="n">x_count</span> <span class="ow">in</span> <span class="n">sorted_x_frequency_column_pair</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">column_location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_used_in_componentbalance_equations</span><span class="p">:</span>
                            <span class="n">dict_key</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;componentbalance&quot;</span><span class="p">,</span> <span class="n">column_location</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">var_equations_registry</span><span class="p">[</span><span class="n">dict_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">componentmassbalance</span><span class="p">[</span><span class="n">column_location</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">columns_used_in_componentbalance_equations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_location</span><span class="p">)</span>
                            <span class="n">vareqindex</span> <span class="o">=</span> <span class="n">vareqindex</span> <span class="o">+</span> <span class="mi">1</span>                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    
                    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">componentmassbalance</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns_used_in_componentbalance_equations</span><span class="p">:</span>
                            <span class="n">dict_key</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;componentbalance&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">var_equations_registry</span><span class="p">[</span><span class="n">dict_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>                            
                            <span class="bp">self</span><span class="o">.</span><span class="n">columns_used_in_componentbalance_equations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                            <span class="n">vareqindex</span> <span class="o">=</span> <span class="n">vareqindex</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># 3) Next assemble component FRACTION balances x= 1</span>
                <span class="c1"># but don&#39;t use streams for which all &#39;x&#39; are known</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rows_used_in_fractionbalance_equations</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># to track rows used</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknownx_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">row_location</span><span class="p">,</span> <span class="n">x_count</span><span class="p">,</span> <span class="ow">in</span> <span class="n">sorted_x_frequency_row_pair</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row_location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows_used_in_fractionbalance_equations</span><span class="p">:</span>
                            <span class="n">dict_key</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;fractionbalance&quot;</span><span class="p">,</span> <span class="n">row_location</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">var_equations_registry</span><span class="p">[</span><span class="n">dict_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">componentmassfractionbalance</span><span class="p">[</span><span class="n">row_location</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rows_used_in_fractionbalance_equations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_location</span><span class="p">)</span>
                            <span class="n">vareqindex</span> <span class="o">=</span> <span class="n">vareqindex</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_equations_registry</span>
        
        
        <span class="c1"># Method inner to solvesystem()</span>
        <span class="c1">#-------------------------------</span>
        <span class="k">def</span> <span class="nf">_get_column_locations_for_trivial_equations</span><span class="p">():</span>
            <span class="c1"># Check for TRIVIAL equations</span>
            <span class="c1"># If &#39;F&#39; or &#39;-F&#39; is an unknown in a column vector of flowrates</span>
            <span class="c1"># then if all the correspoding &#39;x&#39; in a certain column are zero</span>
            <span class="c1"># then componentbalance term F * x = 0, and it vanishes.</span>
            <span class="c1"># The resulting equation of component balance is a scalar quantity that is</span>
            <span class="c1"># independent of &#39;F&#39;/&#39;-F&#39; and &#39;x&#39; and should be excluded from use</span>
            <span class="c1"># by solver.</span>
            <span class="c1"># Prepare rows where flowrate is &quot;F&quot; or &quot;-F&quot;</span>
            <span class="n">row_withPlusF_or_minusF</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minusF_location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plusF_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="c1"># Initialize a placeholder</span>
            <span class="n">iscolumn_xfraction_zero</span> <span class="o">=</span> <span class="p">[]</span>   
            <span class="c1"># Loop across the row where &#39;F&#39; or &#39;-F&#39; exists and check</span>
            <span class="c1"># if x-fraction is zero or not.</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_withPlusF_or_minusF</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">[</span><span class="n">row</span><span class="p">]]</span>
                <span class="n">iscolumn_xfraction_zero</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="c1"># If x-fraction at any location is zero, then check if</span>
            <span class="c1"># x-fraction is zero in that column for all places where &#39;F&#39; or &#39;-F&#39;</span>
            <span class="c1"># occurs. If yes, then F * x = 0 for any F and equation if trivial</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iscolumn_xfraction_zero</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iscolumn_xfraction_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">iscolumn_xfraction_zero</span><span class="p">)</span>    
                <span class="n">trivial_equation_column_location</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">iscolumn_xfraction_zero</span><span class="o">==</span><span class="kc">True</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">trivial_equation_column_location</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_number</span> <span class="k">for</span> <span class="n">column_number</span><span class="p">,</span> <span class="n">boolean</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trivial_equation_column_location</span><span class="p">)</span> <span class="k">if</span> <span class="n">boolean</span> <span class="o">==</span> <span class="kc">True</span> <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trivial_equation_column_location</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">return</span> <span class="n">trivial_equation_column_location</span>
            
            

        <span class="c1"># Method inner to solvesystem()</span>
        <span class="c1">#-------------------------------</span>
        <span class="k">def</span> <span class="nf">_get_dict_keys_for_nonunique_equations</span><span class="p">():</span>
            <span class="c1"># This function assigns arbitrary but unique values to &#39;x&#39;, &#39;F&#39;, and &#39;-F&#39;</span>
            <span class="c1"># Values for the different equations are computed.</span>
            <span class="c1"># These values are compared to each other to determine</span>
            <span class="c1"># whether any of them are equal to each other.</span>
            <span class="c1"># If they are, this will imply that those two or more equations</span>
            <span class="c1"># are not unique and as such only one of them will be used.</span>
            <span class="c1"># Create a variable to store values that correspond</span>
            <span class="c1"># to &#39;x&#39;, &#39;F&#39;, and &#39;-F&#39;</span>
            <span class="n">values_to_check_equation_uniqueness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span><span class="p">)</span>            
            <span class="c1"># Generate unique values to be assigned to for &#39;x&#39;</span>
            <span class="n">x_checkvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span><span class="p">)</span>
            <span class="c1"># Generate unique values to be assigned to for &#39;F&#39; and &#39;-F&#39;</span>
            <span class="n">F_checkvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span><span class="p">)</span>
            <span class="c1"># Assign these values</span>
            <span class="n">values_to_check_equation_uniqueness</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_checkvalues</span>
            <span class="n">values_to_check_equation_uniqueness</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span><span class="p">:]</span> <span class="o">=</span> <span class="n">F_checkvalues</span>
            <span class="c1"># Pass these &#39;x&#39;, &#39;F&#39; and &#39;-F&#39; values to the equations assembled</span>
            <span class="c1"># in function called _assemble_all_possible_balance_and_extrainfo_equations</span>
            <span class="n">all_possible_equations</span> <span class="o">=</span> <span class="n">_assemble_all_possible_balance_and_extrainfo_equations</span><span class="p">(</span><span class="n">values_to_check_equation_uniqueness</span><span class="p">)</span>
            <span class="c1"># Analyse the numerical values obtained from each equation.</span>
            <span class="c1"># Identify any equation values that are repeated.</span>
            <span class="c1"># Repetition of equation result, despite assigning each &#39;x&#39;, &#39;F&#39; and &#39;-F&#39;</span>
            <span class="c1"># a unique value means that those equations must be identical</span>
            <span class="c1"># all_possible_equations = {&quot;1&quot;:1, &quot;2&quot;:1, &quot;3&quot;:2, &quot;4&quot;:4, &quot;5&quot;:3, &quot;11&quot;:123, &quot;34&quot;:1, &quot;ss&quot;:123}</span>
            <span class="c1"># create dict of equation values and their frequencies</span>
            <span class="n">equationvalue_frequencies</span><span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_possible_equations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="c1"># if equations are not unique, value of equation will be repeated</span>
            <span class="n">non_unique_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">equationvalue_frequencies</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># find dict key corresponding to repeating equation value</span>
            <span class="n">non_unique_keys</span> <span class="o">=</span> <span class="p">[[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">all_possible_equations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="n">itemtomatch</span><span class="p">]</span> <span class="k">for</span> <span class="n">itemtomatch</span> <span class="ow">in</span> <span class="n">non_unique_values</span><span class="p">]</span>
            <span class="c1"># Of these non-unique values, the very first one will be used</span>
            <span class="c1"># and the rest will be removed/deleted, so start at index &#39;1&#39; not &#39;0&#39;</span>
            <span class="n">non_unique_keys_todelete</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">non_unique_keys</span><span class="p">]</span>
            <span class="n">non_unique_keys_todelete_as_flatlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">non_unique_keys_todelete</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">non_unique_keys_todelete_as_flatlist</span>
            
        
        <span class="k">def</span> <span class="nf">_unique_equations_to_solve</span><span class="p">(</span><span class="n">guessvalues</span><span class="p">,</span> <span class="n">keys_to_delete</span><span class="p">):</span>
            <span class="c1"># This function is called by &#39;leastsq&#39;</span>
            <span class="c1"># The guessvalues are passed to</span>
            <span class="c1"># &quot;_assemble_all_possible_balance_and_extrainfo_equations&quot;</span>
            <span class="c1"># This creates and returns all possible equations</span>
            <span class="n">all_possible_equations</span> <span class="o">=</span> <span class="n">_assemble_all_possible_balance_and_extrainfo_equations</span><span class="p">(</span><span class="n">guessvalues</span><span class="p">)</span>
            <span class="c1"># From these possible equations, the unique ones are selected</span>
            <span class="c1"># and returned</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">keys_to_delete</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">all_possible_equations</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_possible_equations</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span><span class="p">]</span>
        
        
        <span class="k">def</span> <span class="nf">_prepare_guess_values</span><span class="p">():</span>
            <span class="c1"># PREPARE GUESS VALUES TO CALL &#39;leastsquare&#39; ----&gt; called &#39;leastsq&#39;</span>
            <span class="c1"># -----------------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalunknowns</span><span class="p">)</span>
            <span class="n">guessindex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># guessvalues are used to assign values to unknown &#39;x&#39; and &#39;F&#39;</span>
            <span class="c1"># First the &#39;x&#39; values are assigned, and then &#39;F&#39; values</span>
            <span class="c1"># So we construct guessvalues such that it&#39;s initial elements</span>
            <span class="c1"># corresponding to &#39;x&#39; are initialized to 0.5 </span>
            <span class="c1"># since &#39;x&#39; lies between 0 and 1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_x_count</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span><span class="p">[</span><span class="n">guessindex</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
                    <span class="n">guessindex</span> <span class="o">=</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># The remainder elements of guessvalues must be set equal to flow rates</span>
            <span class="c1"># that are already known.</span>
            <span class="c1"># So we find known flow rate values to use them in initilization.</span>
            <span class="c1"># If we randomly initialize guess values of flowrates to say 1, 100, or 1000 etc</span>
            <span class="c1"># then the fsolve function maynot converge because these random values</span>
            <span class="c1"># maybe far from the true solution</span>
            <span class="n">knownflowrates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">flow</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="k">if</span> <span class="p">(</span><span class="n">flow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;F&quot;</span> <span class="ow">and</span> <span class="n">flow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-F&quot;</span><span class="p">)]</span>
            <span class="n">sorted_knownflowrates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">knownflowrates</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unknown_Fs_count</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownflowrates</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span><span class="p">[</span><span class="n">guessindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_knownflowrates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">guessindex</span> <span class="o">=</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># use the last flowrate in list as guess value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span><span class="p">[</span><span class="n">guessindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">knownflowrates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">guessindex</span> <span class="o">=</span> <span class="n">guessindex</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span>
        
        <span class="c1"># STEPS to Solve System</span>
        <span class="c1"># Step 1) Prepare guess values</span>
        <span class="n">_prepare_guess_values</span><span class="p">()</span>
        <span class="c1"># Step 2) Obtain locations of trivial equations</span>
        <span class="n">trivial_equation_column_locations</span> <span class="o">=</span> <span class="n">_get_column_locations_for_trivial_equations</span><span class="p">()</span>
        <span class="c1"># create keys corresponding to the trivial equation columns</span>
        <span class="c1"># the key will be of signature ---&gt; tuple (&quot;componentbalance&quot;, column)</span>
        <span class="n">keys_for_trivial_equation_column_locations</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;componentbalance&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">trivial_equation_column_locations</span><span class="p">]</span>        
        <span class="c1"># Step 3) Obtain locations for unique equations</span>
        <span class="n">keys_of_nonunique_equations</span> <span class="o">=</span> <span class="n">_get_dict_keys_for_nonunique_equations</span><span class="p">()</span>
        <span class="n">keys_for_equations_tobe_deleted</span> <span class="o">=</span> <span class="n">keys_for_trivial_equation_column_locations</span> <span class="o">+</span> <span class="n">keys_of_nonunique_equations</span>
        <span class="c1"># Step 4) Call equation solver &quot;leastsq&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span><span class="p">)</span>
        <span class="c1"># z1,cov,infodict,mesg,ier = leastsq(_unique_equations_to_solve, self.guessvalues,</span>
        <span class="c1">#                                     args=(keys_for_equations_tobe_deleted),</span>
        <span class="c1">#                                     maxfev= 1000*(N+2),full_output=True)</span>
        <span class="c1"># print(&quot;\nTotal calls made by solver:&quot;,infodict[&quot;nfev&quot;])</span>
        <span class="c1"># print(&quot;result of last func call made :&quot;,infodict[&quot;fvec&quot;])</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">_unique_equations_to_solve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">guessvalues</span><span class="p">,</span>
                   <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">keys_for_equations_tobe_deleted</span><span class="p">),</span>
                   <span class="n">maxfev</span><span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>

        <span class="c1"># CHECK SOLUTION VALIDITY</span>
        <span class="c1"># ------------------------</span>
        <span class="c1"># 1) (F)in + (F)out = 0</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">sumof_overallflowrates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># print(&quot;sumof_overallflowrates&quot;,sumof_overallflowrates)</span>
        <span class="c1"># print(&quot;self.flowrates&quot;, self.npflowrates)</span>
        <span class="c1"># 2) Create the species/component balance: (Fx)in - (Fx)out = 0</span>
        <span class="n">sumof_componentflowrates</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># print(&quot;sumof_componentflowrates&quot;,sumof_componentflowrates)</span>
        <span class="c1"># 3) Create the component fraction balance: (x) = 1</span>
        <span class="n">sumof_componentfractions_ineachstream</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># print(&quot;fraction balance =&quot;, sumof_componentfractions_ineachstream)</span>
        <span class="c1"># 4) Perform balance-checks</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">sumof_overallflowrates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span> <span class="ow">and</span>
              <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">sumof_componentflowrates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span> <span class="ow">and</span>
              <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">sumof_componentfractions_ineachstream</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknowns successfully computed:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Streams with new data have been created.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You can view the solved system by printing the returned object.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;sol&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">_create_solvedsystem_summary</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">processname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npstreamnames</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">npflowrates</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">npfractions</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrainfos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unknowns could not be successfully computed&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please check that you have correctly set up the system.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Also check your system with &#39;degree of freedom&#39; analysis&quot;</span><span class="p">)</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">sol</span></div></div>
   
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">Mixer_NaOH</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;Mixer_NaOH&quot;</span><span class="p">)</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Water</span> <span class="o">=</span> <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Water&quot;</span><span class="p">])</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Water</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Water</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Water</span><span class="o">.</span><span class="n">setextrainfo</span><span class="p">([</span><span class="s2">&quot;Water=0.9*Product&quot;</span><span class="p">])</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">NaOH</span> <span class="o">=</span> <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NaOH&quot;</span><span class="p">])</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">NaOH</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">NaOH</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Product</span> <span class="o">=</span> <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Product&quot;</span><span class="p">])</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
    <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Mixer_NaOH</span><span class="p">)</span>
    <span class="n">sol2</span> <span class="o">=</span> <span class="n">Mixer_NaOH</span><span class="o">.</span><span class="n">solvesystem</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sol2</span><span class="p">)</span>
    
    
    <span class="c1">### Extraction Distillation</span>
    <span class="c1">###########################</span>
    <span class="c1"># https://www.youtube.com/watch?v=my1ZTIDSMbs</span>
    <span class="c1"># Define processes</span>
    <span class="n">extraction</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;Liquid-Liquid Extraction&quot;</span><span class="p">)</span>
    <span class="n">distillation</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;Distillation&quot;</span><span class="p">)</span>
    <span class="n">overall</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;Overall&quot;</span><span class="p">)</span> <span class="c1"># dashed boundary (a) in figure</span>
    
    <span class="c1"># Assign streams to processes</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m1_in</span> <span class="o">=</span> <span class="n">extraction</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m1_in&quot;</span><span class="p">])</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m1_in</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;+F&quot;</span><span class="p">)</span>
    <span class="c1"># Component-1: Acetic Acid, component-2: Water, component-3: Hexanol</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m1_in</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    
    <span class="n">extraction</span><span class="o">.</span><span class="n">m2_in</span> <span class="o">=</span> <span class="n">extraction</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m2_in&quot;</span><span class="p">])</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m2_in</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;+F&quot;</span><span class="p">)</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m2_in</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">])</span>
    
    <span class="n">extraction</span><span class="o">.</span><span class="n">m3_out</span> <span class="o">=</span> <span class="n">extraction</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m3_out&quot;</span><span class="p">])</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m3_out</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m3_out</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">])</span>
    
    <span class="n">extraction</span><span class="o">.</span><span class="n">m4_out</span> <span class="o">=</span> <span class="n">extraction</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m4_out&quot;</span><span class="p">])</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m4_out</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m4_out</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    
    <span class="n">distillation</span><span class="o">.</span><span class="n">m3_in</span> <span class="o">=</span> <span class="n">distillation</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m3_in&quot;</span><span class="p">])</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">m3_in</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">extraction</span><span class="o">.</span><span class="n">m3_out</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    
    <span class="n">distillation</span><span class="o">.</span><span class="n">m5_out</span> <span class="o">=</span> <span class="n">distillation</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m5_out&quot;</span><span class="p">])</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">m5_out</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">m5_out</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mf">0.96</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">])</span>
    
    <span class="n">distillation</span><span class="o">.</span><span class="n">m6_out</span> <span class="o">=</span> <span class="n">distillation</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m6_out&quot;</span><span class="p">])</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">m6_out</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="s2">&quot;-F&quot;</span><span class="p">)</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">m6_out</span><span class="o">.</span><span class="n">setfractions</span><span class="p">([</span><span class="mf">0.028</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.972</span><span class="p">])</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">m6_out</span><span class="o">.</span><span class="n">setextrainfo</span><span class="p">([</span><span class="s2">&quot;3:m6_out=0.95*m2_in&quot;</span><span class="p">])</span>
    
    <span class="n">overall</span><span class="o">.</span><span class="n">m1_in</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m1_in&quot;</span><span class="p">])</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">m2_in</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m2_in&quot;</span><span class="p">])</span>   
    <span class="n">overall</span><span class="o">.</span><span class="n">m4_out</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m4_out&quot;</span><span class="p">])</span>   
    <span class="n">overall</span><span class="o">.</span><span class="n">m5_out</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m5_out&quot;</span><span class="p">])</span>   
    <span class="n">overall</span><span class="o">.</span><span class="n">m6_out</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m6_out&quot;</span><span class="p">])</span>                      
    <span class="n">overall</span><span class="o">.</span><span class="n">m1_in</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">extraction</span><span class="o">.</span><span class="n">m1_in</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">m2_in</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">extraction</span><span class="o">.</span><span class="n">m2_in</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">m4_out</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">extraction</span><span class="o">.</span><span class="n">m4_out</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">m5_out</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">distillation</span><span class="o">.</span><span class="n">m5_out</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">m6_out</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">distillation</span><span class="o">.</span><span class="n">m6_out</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    
    <span class="c1"># Print streams to verify they are defined correctly</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">extraction</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">distillation</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">overall</span><span class="p">)</span>
    
    <span class="c1"># Perform degree of freedom analysis</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">distillation</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    
    <span class="c1"># From degree of freedom analysis it is clear that none</span>
    <span class="c1"># of the processes have degree of freedom = 0.</span>
    <span class="c1"># Therefore, as such the system cannot be solved.</span>
    <span class="c1"># However, for the &#39;overall; process the degree of freedom = 1.</span>
    <span class="c1"># If one of the flow rate is assumed, this will allow the</span>
    <span class="c1"># process to be solved.</span>
    <span class="c1"># Thus let m2 = 100</span>
    
    <span class="n">overall</span><span class="o">.</span><span class="n">m2_in</span><span class="o">.</span><span class="n">setflow</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># Check degrees of freedom again</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    
    <span class="c1"># The analysis now shows that &quot;overall&quot; system can be solved.</span>
    <span class="n">overall_solution</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">solvesystem</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">overall_solution</span><span class="p">)</span>
    
    <span class="c1"># All streams except m3 are now known.</span>
    <span class="c1"># To find stream m3, update information for streams</span>
    <span class="c1"># computed from &quot;overall&quot; balance.</span>
    <span class="c1"># Update the extraction streams</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m1_in</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">overall_solution</span><span class="o">.</span><span class="n">m1_in</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m2_in</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">overall_solution</span><span class="o">.</span><span class="n">m2_in</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">m4_out</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">overall_solution</span><span class="o">.</span><span class="n">m4_out</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="c1"># Check system streams</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">extraction</span><span class="p">)</span>
    <span class="c1"># Check degrees of freedom again</span>
    <span class="n">extraction</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="c1"># a = extraction.find_unknownflowrate()</span>
    <span class="c1"># extraction.update_streamflowrates(a)</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">extraction</span><span class="o">.</span><span class="n">solvesystem</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

    <span class="c1">##### Unit1 Unit 2</span>
    <span class="c1">## https://www.youtube.com/watch?v=JfD5iyoKD8w</span>
    <span class="n">overall</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;overall&quot;</span><span class="p">)</span>
    <span class="n">mixer</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;mixer&quot;</span><span class="p">)</span>
    <span class="n">unit1</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;unit1&quot;</span><span class="p">)</span>
    <span class="n">unit2</span> <span class="o">=</span> <span class="n">PhysicalProcess</span><span class="p">(</span><span class="s2">&quot;unit2&quot;</span><span class="p">)</span>
    <span class="c1"># attach streams to mixer</span>
    <span class="n">streamnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;feed1&quot;</span><span class="p">,</span> <span class="s2">&quot;feed2&quot;</span><span class="p">,</span> <span class="s2">&quot;feedmix&quot;</span><span class="p">]</span>
    <span class="n">flowrates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;-F&quot;</span><span class="p">]</span>
    <span class="n">fractions</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
    <span class="n">mixer</span><span class="o">.</span><span class="n">feed1</span><span class="p">,</span> <span class="n">mixer</span><span class="o">.</span><span class="n">feed2</span><span class="p">,</span> <span class="n">mixer</span><span class="o">.</span><span class="n">feedmix</span> <span class="o">=</span> <span class="n">mixer</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="n">streamnames</span><span class="p">,</span> <span class="n">flowrates</span><span class="o">=</span><span class="n">flowrates</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="n">fractions</span><span class="p">)</span>
    <span class="c1"># attach streams to unit 1</span>
    <span class="n">streamnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unit1feed&quot;</span><span class="p">,</span> <span class="s2">&quot;top1&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom1&quot;</span><span class="p">]</span>
    <span class="n">flowrates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;-F&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">]</span>
    <span class="n">fractions</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
    <span class="n">unit1</span><span class="o">.</span><span class="n">unit1feed</span><span class="p">,</span> <span class="n">unit1</span><span class="o">.</span><span class="n">top1</span><span class="p">,</span> <span class="n">unit1</span><span class="o">.</span><span class="n">bottom1</span> <span class="o">=</span> <span class="n">unit1</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="n">streamnames</span><span class="p">,</span> <span class="n">flowrates</span><span class="o">=</span><span class="n">flowrates</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="n">fractions</span><span class="p">)</span>
    <span class="c1"># attach streams to unit 2</span>
    <span class="n">streamnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unit2feed&quot;</span><span class="p">,</span> <span class="s2">&quot;top2&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom2&quot;</span><span class="p">]</span>
    <span class="n">flowrates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="s2">&quot;-F&quot;</span><span class="p">,</span> <span class="s2">&quot;-F&quot;</span><span class="p">]</span>
    <span class="n">fractions</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
    <span class="n">unit2</span><span class="o">.</span><span class="n">unit2feed</span><span class="p">,</span> <span class="n">unit2</span><span class="o">.</span><span class="n">top2</span><span class="p">,</span> <span class="n">unit2</span><span class="o">.</span><span class="n">bottom2</span> <span class="o">=</span> <span class="n">unit2</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="n">streamnames</span><span class="p">,</span> <span class="n">flowrates</span><span class="o">=</span><span class="n">flowrates</span><span class="p">,</span> <span class="n">fractions</span><span class="o">=</span><span class="n">fractions</span><span class="p">)</span>
    <span class="c1"># attach streams to overall    </span>
    <span class="n">streamnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;feed1&quot;</span><span class="p">,</span> <span class="s2">&quot;feed2&quot;</span><span class="p">,</span> <span class="s2">&quot;top1&quot;</span><span class="p">,</span> <span class="s2">&quot;top2&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom2&quot;</span><span class="p">]</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">feed1</span><span class="p">,</span> <span class="n">overall</span><span class="o">.</span><span class="n">feed2</span><span class="p">,</span> <span class="n">overall</span><span class="o">.</span><span class="n">top1</span><span class="p">,</span> <span class="n">overall</span><span class="o">.</span><span class="n">top2</span><span class="p">,</span> <span class="n">overall</span><span class="o">.</span><span class="n">bottom2</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">attachstreams</span><span class="p">(</span><span class="n">streamnames</span><span class="o">=</span><span class="n">streamnames</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">feed1</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">mixer</span><span class="o">.</span><span class="n">feed1</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">feed2</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">mixer</span><span class="o">.</span><span class="n">feed2</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">top1</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">unit1</span><span class="o">.</span><span class="n">top1</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">top2</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">unit2</span><span class="o">.</span><span class="n">top2</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">bottom2</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">unit2</span><span class="o">.</span><span class="n">bottom2</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">feed2</span><span class="o">.</span><span class="n">setextrainfo</span><span class="p">([</span><span class="s2">&quot;top1=1*top2&quot;</span><span class="p">])</span>
   
    <span class="c1"># print the systems to verify</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mixer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">unit1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">unit2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">overall</span><span class="p">)</span>
    
    <span class="c1"># Compute degrees of freedom</span>
    <span class="n">mixer</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">unit1</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">unit2</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    
    <span class="c1"># Based on Degrees of freedom analysis</span>
    <span class="c1"># mixer can be solved</span>
    <span class="n">mixersol</span> <span class="o">=</span> <span class="n">mixer</span><span class="o">.</span><span class="n">solvesystem</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mixersol</span><span class="p">)</span>
    
    <span class="c1"># Assign mixer outlet to unit1</span>
    <span class="n">unit1</span><span class="o">.</span><span class="n">unit1feed</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">mixersol</span><span class="o">.</span><span class="n">feedmix</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">unit1</span><span class="p">)</span>
    
    
    <span class="c1">#Find degrees of freedom again</span>
    <span class="n">unit1</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">unit2</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="c1"># DOF for unit1 = 0 ---&gt; so solve unit1</span>
    <span class="n">unit1sol</span> <span class="o">=</span> <span class="n">unit1</span><span class="o">.</span><span class="n">solvesystem</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">unit1sol</span><span class="p">)</span>
    <span class="c1"># Assign newly found streams</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">top1</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">unit1sol</span><span class="o">.</span><span class="n">top1</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">unit2</span><span class="o">.</span><span class="n">unit2feed</span><span class="o">.</span><span class="n">setequalto</span><span class="p">(</span><span class="n">unit1sol</span><span class="o">.</span><span class="n">bottom1</span><span class="p">,</span> <span class="n">flowdirection</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">unit2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">overall</span><span class="p">)</span>
    
    <span class="c1">#Find degrees of freedom again</span>
    <span class="n">unit2</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">degreesoffreedom</span><span class="p">()</span>
    <span class="c1"># DOF of overall = 0 ---&gt; so solve overall</span>
    <span class="n">overallsol</span> <span class="o">=</span> <span class="n">overall</span><span class="o">.</span><span class="n">solvesystem</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">overallsol</span><span class="p">)</span>

    
  
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Harvinder Singh Gill.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<div class="footer">This page uses <a href="https://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script>
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>


</body>
</html>